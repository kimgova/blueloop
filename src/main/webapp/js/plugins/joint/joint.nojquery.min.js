/*

 Lo-Dash 2.2.1 (Custom Build) <http://lodash.com/>
 Build: `lodash modern -o ./dist/lodash.js`
 Copyright 2012-2013 The Dojo Foundation <http://dojofoundation.org/>
 Based on Underscore.js 1.5.2 <http://underscorejs.org/LICENSE>
 Copyright 2009-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 Available under MIT license <http://lodash.com/license>
*/
(function(){function a(a,b,c){c=(c||0)-1;for(var f=a?a.length:0;++c<f;)if(a[c]===b)return c;return-1}function b(b,c){var f=typeof c;b=b.cache;if("boolean"==f||null==c)return b[c]?0:-1;"number"!=f&&"string"!=f&&(f="object");var d="number"==f?c:F+c;b=(b=b[f])&&b[d];return"object"==f?b&&-1<a(b,c)?0:-1:b?0:-1}function c(a){var b=this.cache,c=typeof a;if("boolean"==c||null==a)b[a]=!0;else{"number"!=c&&"string"!=c&&(c="object");var f="number"==c?a:F+a,b=b[c]||(b[c]={});"object"==c?(b[f]||(b[f]=[])).push(a):
b[f]=!0}}function d(a){return a.charCodeAt(0)}function e(a,b){var c=a.criteria,f=b.criteria;if(c!==f){if(c>f||"undefined"==typeof c)return 1;if(c<f||"undefined"==typeof f)return-1}return a.index-b.index}function l(a){var b=-1,f=a.length,d=a[0],k=a[f/2|0],t=a[f-1];if(d&&"object"==typeof d&&k&&"object"==typeof k&&t&&"object"==typeof t)return!1;d=r();d["false"]=d["null"]=d["true"]=d.undefined=!1;k=r();k.array=a;k.cache=d;for(k.push=c;++b<f;)k.push(a[b]);return k}function p(a){return"\\"+ba[a]}function h(){return A.pop()||
[]}function r(){return z.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,value:null}}function n(){}function u(a){a.length=0;40>A.length&&A.push(a)}function q(a){var b=a.cache;b&&q(b);a.array=a.cache=a.criteria=a.object=a.number=a.string=a.value=null;40>z.length&&z.push(a)}function v(a,b,c){b||(b=0);"undefined"==typeof c&&(c=a?a.length:0);var f=-1;c=c-b||0;for(var d=Array(0>c?0:c);++f<c;)d[f]=a[b+f];return d}
function y(c){function m(a){return a&&"object"==typeof a&&!T(a)&&J.call(a,"__wrapped__")?a:new ba(a)}function ba(a,b){this.__chain__=!!b;this.__wrapped__=a}function A(a,b,c,ja,d){if(c){var k=c(a);if("undefined"!=typeof k)return k}if(U(a)){var t=K.call(a);if(!f[t])return a;var n=ga[t];switch(t){case "[object Boolean]":case "[object Date]":return new n(+a);case "[object Number]":case "[object String]":return new n(a);case "[object RegExp]":return k=n(a.source,ca.exec(a)),k.lastIndex=a.lastIndex,k}}else return a;
t=T(a);if(b){var e=!ja;ja||(ja=h());d||(d=h());for(var q=ja.length;q--;)if(ja[q]==a)return d[q];k=t?n(a.length):{}}else k=t?v(a):Na({},a);t&&(J.call(a,"index")&&(k.index=a.index),J.call(a,"input")&&(k.input=a.input));if(!b)return k;ja.push(a);d.push(k);(t?L:H)(a,function(a,C){k[C]=A(a,b,c,ja,d)});e&&(u(ja),u(d));return k}function z(a,b,c){if("function"!=typeof a)return Oa;if("undefined"==typeof b)return a;var f=a.__bindData__||ka.funcNames&&!a.name;if("undefined"==typeof f){var d=O&&Hb.call(a);ka.funcNames||
!d||la.test(d)||(f=!0);if(ka.funcNames||!f)f=!ka.funcDecomp||O.test(d),eb(a,f)}if(!0!==f&&f&&f[1]&1)return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,f){return a.call(b,c,f)};case 3:return function(c,f,ta){return a.call(b,c,f,ta)};case 4:return function(c,f,ta,d){return a.call(b,c,f,ta,d)}}return fb(a,b)}function R(a,b,c,f){f=(f||0)-1;for(var d=a?a.length:0,k=[];++f<d;){var t=a[f];if(t&&"object"==typeof t&&"number"==typeof t.length&&(T(t)||gb(t))){b||(t=R(t,
b,c));var n=-1,h=t.length,e=k.length;for(k.length+=h;++n<h;)k[e++]=t[n]}else c||k.push(t)}return k}function aa(a,b,c,f,d,k){if(c){var t=c(a,b);if("undefined"!=typeof t)return!!t}if(a===b)return 0!==a||1/a==1/b;if(!(a!==a||a&&D[typeof a]||b&&D[typeof b]))return!1;if(null==a||null==b)return a===b;var n=K.call(a),e=K.call(b);"[object Arguments]"==n&&(n="[object Object]");"[object Arguments]"==e&&(e="[object Object]");if(n!=e)return!1;switch(n){case "[object Boolean]":case "[object Date]":return+a==+b;
case "[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case "[object RegExp]":case "[object String]":return a==qa(b)}e="[object Array]"==n;if(!e){if(J.call(a,"__wrapped__ ")||J.call(b,"__wrapped__"))return aa(a.__wrapped__||a,b.__wrapped__||b,c,f,d,k);if("[object Object]"!=n)return!1;var n=a.constructor,q=b.constructor;if(n!=q&&!(G(n)&&n instanceof n&&G(q)&&q instanceof q))return!1}q=!d;d||(d=h());k||(k=h());for(n=d.length;n--;)if(d[n]==a)return k[n]==b;var l=0,t=!0;d.push(a);k.push(b);if(e){n=
a.length;l=b.length;t=l==a.length;if(!t&&!f)return t;for(;l--;)if(e=n,q=b[l],f)for(;e--&&!(t=aa(a[e],q,c,f,d,k)););else if(!(t=aa(a[l],q,c,f,d,k)))break;return t}ma(b,function(b,fa,n){if(J.call(n,fa))return l++,t=J.call(a,fa)&&aa(a[fa],b,c,f,d,k)});t&&!f&&ma(a,function(a,b,C){if(J.call(C,b))return t=-1<--l});q&&(u(d),u(k));return t}function ia(a,b,c,f,d){(T(b)?L:H)(b,function(b,fa){var k,t,n=b,e=a[fa];if(b&&((t=T(b))||Pa(b))){for(n=f.length;n--;)if(k=f[n]==b){e=d[n];break}if(!k){var h;c&&(n=c(e,b),
h="undefined"!=typeof n)&&(e=n);h||(e=t?T(e)?e:[]:Pa(e)?e:{});f.push(b);d.push(e);h||ia(e,b,c,f,d)}}else c&&(n=c(e,b),"undefined"==typeof n&&(n=b)),"undefined"!=typeof n&&(e=n);a[fa]=e})}function hb(C,c,f){var d=-1,k=xa(),t=C?C.length:0,n=[],e=!c&&75<=t&&k===a,w=f||e?h():n;if(e){var p=l(w);p?(k=b,w=p):(e=!1,w=f?w:(u(w),n))}for(;++d<t;){var p=C[d],m=f?f(p,d,C):p;if(c?!d||w[w.length-1]!==m:0>k(w,m))(f||e)&&w.push(m),n.push(p)}e?(u(w.array),q(w)):f&&u(w);return n}function Qa(a){return function(b,c,f){var d=
{};c=m.createCallback(c,f,3);f=-1;var k=b?b.length:0;if("number"==typeof k)for(;++f<k;){var t=b[f];a(d,t,c(t,f,b),b)}else H(b,function(b,f,fa){a(d,b,c(b,f,fa),fa)});return d}}function da(a,b,c,f,d,k){var t=b&1,n=b&2,e=b&4,h=b&8,q=b&16,l=b&32,u=a;if(!n&&!G(a))throw new W;q&&!c.length&&(b&=-17,q=c=!1);l&&!f.length&&(b&=-33,l=f=!1);var w=a&&a.__bindData__;if(w)return!t||w[1]&1||(w[4]=d),!t&&w[1]&1&&(b|=8),!e||w[1]&4||(w[5]=k),q&&ra.apply(w[2]||(w[2]=[]),c),l&&ra.apply(w[3]||(w[3]=[]),f),w[1]|=b,da.apply(null,
w);if(!t||n||e||l||!(ka.fastBind||na&&q))m=function(){var w=arguments,p=t?d:this;if(e||q||l)if(w=X.call(w),q&&Ib.apply(w,c),l&&ra.apply(w,f),e&&w.length<k)return b|=16,da(a,h?b:b&-4,w,null,d,k);n&&(a=p[u]);return this instanceof m?(p=Ra(a.prototype),w=a.apply(p,w),U(w)?w:p):a.apply(p,w)};else{if(q){var p=[d];ra.apply(p,c)}var m=q?na.apply(a,p):na.call(a,d)}eb(m,X.call(arguments));return m}function Ra(a){return U(a)?Fa(a):{}}function Jb(a){return Sa[a]}function xa(){var b=(b=m.indexOf)===ib?a:b;return b}
function Kb(a){var b,c;if(!a||"[object Object]"!=K.call(a)||(b=a.constructor,G(b)&&!(b instanceof b)))return!1;ma(a,function(a,b){c=b});return"undefined"==typeof c||J.call(a,c)}function Lb(a){return jb[a]}function gb(a){return a&&"object"==typeof a&&"number"==typeof a.length&&"[object Arguments]"==K.call(a)||!1}function kb(a,b,c){var f=M(a),d=f.length;for(b=z(b,c,3);d--&&(c=f[d],!1!==b(a[c],c,a)););return a}function Ga(a){var b=[];ma(a,function(a,c){G(a)&&b.push(c)});return b.sort()}function lb(a){for(var b=
-1,c=M(a),f=c.length,d={};++b<f;){var k=c[b];d[a[k]]=k}return d}function G(a){return"function"==typeof a}function U(a){return!(!a||!D[typeof a])}function mb(a){return"number"==typeof a||"[object Number]"==K.call(a)}function ya(a){return"string"==typeof a||"[object String]"==K.call(a)}function Ha(a){for(var b=-1,c=M(a),f=c.length,d=P(f);++b<f;)d[b]=a[c[b]];return d}function nb(a,b,c){var f=-1,d=xa(),k=a?a.length:0,t=!1;c=(0>c?Y(0,k+c):c)||0;T(a)?t=-1<d(a,b,c):"number"==typeof k?t=-1<(ya(a)?a.indexOf(b,
c):d(a,b,c)):H(a,function(a){if(++f>=c)return!(t=a===b)});return t}function ob(a,b,c){var f=!0;b=m.createCallback(b,c,3);c=-1;var d=a?a.length:0;if("number"==typeof d)for(;++c<d&&(f=!!b(a[c],c,a)););else H(a,function(a,c,C){return f=!!b(a,c,C)});return f}function Ia(a,b,c){var f=[];b=m.createCallback(b,c,3);c=-1;var d=a?a.length:0;if("number"==typeof d)for(;++c<d;){var k=a[c];b(k,c,a)&&f.push(k)}else H(a,function(a,c,C){b(a,c,C)&&f.push(a)});return f}function Ta(a,b,c){b=m.createCallback(b,c,3);c=
-1;var f=a?a.length:0;if("number"==typeof f)for(;++c<f;){var d=a[c];if(b(d,c,a))return d}else{var k;H(a,function(a,c,f){if(b(a,c,f))return k=a,!1});return k}}function L(a,b,c){var f=-1,d=a?a.length:0;b=b&&"undefined"==typeof c?b:z(b,c,3);if("number"==typeof d)for(;++f<d&&!1!==b(a[f],f,a););else H(a,b);return a}function Ja(a,b,c){var f=a?a.length:0;b=b&&"undefined"==typeof c?b:z(b,c,3);if("number"==typeof f)for(;f--&&!1!==b(a[f],f,a););else{var d=M(a),f=d.length;H(a,function(a,c,C){c=d?d[--f]:--f;
return b(C[c],c,C)})}return a}function Ka(a,b,c){var f=-1,d=a?a.length:0;b=m.createCallback(b,c,3);if("number"==typeof d)for(var k=P(d);++f<d;)k[f]=b(a[f],f,a);else k=[],H(a,function(a,c,C){k[++f]=b(a,c,C)});return k}function pb(a,b,c){var f=-Infinity,k=f;if(!b&&T(a)){c=-1;for(var t=a.length;++c<t;){var n=a[c];n>k&&(k=n)}}else b=!b&&ya(a)?d:m.createCallback(b,c,3),L(a,function(a,c,C){c=b(a,c,C);c>f&&(f=c,k=a)});return k}function Ua(a,b){var c=-1,f=a?a.length:0;if("number"==typeof f)for(var d=P(f);++c<
f;)d[c]=a[c][b];return d||Ka(a,b)}function Va(a,b,c,f){if(!a)return c;var d=3>arguments.length;b=z(b,f,4);var k=-1,t=a.length;if("number"==typeof t)for(d&&(c=a[++k]);++k<t;)c=b(c,a[k],k,a);else H(a,function(a,f,C){c=d?(d=!1,a):b(c,a,f,C)});return c}function qb(a,b,c,f){var d=3>arguments.length;b=z(b,f,4);Ja(a,function(a,f,C){c=d?(d=!1,a):b(c,a,f,C)});return c}function rb(a){var b=-1,c=a?a.length:0,f=P("number"==typeof c?c:0);L(a,function(a){var c=Wa(++b);f[b]=f[c];f[c]=a});return f}function sb(a,
b,c){var f;b=m.createCallback(b,c,3);c=-1;var d=a?a.length:0;if("number"==typeof d)for(;++c<d&&!(f=b(a[c],c,a)););else H(a,function(a,c,C){return!(f=b(a,c,C))});return!!f}function tb(c){var f=-1,d=xa(),k=c?c.length:0,t=R(arguments,!0,!0,1),n=[],e=75<=k&&d===a;if(e){var h=l(t);h?(d=b,t=h):e=!1}for(;++f<k;)h=c[f],0>d(t,h)&&n.push(h);e&&q(t);return n}function Xa(a,b,c){var f=0,d=a?a.length:0;if("number"!=typeof b&&null!=b){var k=-1;for(b=m.createCallback(b,c,3);++k<d&&b(a[k],k,a);)f++}else if(f=b,null==
f||c)return a?a[0]:x;return v(a,0,za(Y(0,f),d))}function ib(b,c,f){if("number"==typeof f){var d=b?b.length:0;f=0>f?Y(0,d+f):f||0}else if(f)return f=ub(b,c),b[f]===c?f:-1;return a(b,c,f)}function Ya(a,b,c){if("number"!=typeof b&&null!=b){var f=0,d=-1,k=a?a.length:0;for(b=m.createCallback(b,c,3);++d<k&&b(a[d],d,a);)f++}else f=null==b||c?1:Y(0,b);return v(a,f)}function ub(a,b,c,f){var d=0,k=a?a.length:d;c=c?m.createCallback(c,f,1):Oa;for(b=c(b);d<k;)f=d+k>>>1,c(a[f])<b?d=f+1:k=f;return d}function vb(a,
b,c,f){"boolean"!=typeof b&&null!=b&&(c=(f=c)&&f[b]===a?null:b,b=!1);null!=c&&(c=m.createCallback(c,f,3));return hb(a,b,c)}function wb(){for(var a=1<arguments.length?arguments:arguments[0],b=-1,c=a?pb(Ua(a,"length")):0,f=P(0>c?0:c);++b<c;)f[b]=Ua(a,b);return f}function xb(a,b){for(var c=-1,f=a?a.length:0,d={};++c<f;){var k=a[c];b?d[k]=b[c]:k&&(d[k[0]]=k[1])}return d}function fb(a,b){return 2<arguments.length?da(a,17,X.call(arguments,2),null,b):da(a,1,null,null,b)}function yb(a,b,c){var f,d,k,t,n,
e,h,q=0,w=!1,l=!0;if(!G(a))throw new W;b=Y(0,b)||0;if(!0===c)var u=!0,l=!1;else U(c)&&(u=c.leading,w="maxWait"in c&&(Y(b,c.maxWait)||0),l="trailing"in c?c.trailing:l);var p=function(){var c=b-(ua()-t);0>=c?(d&&Za(d),c=h,d=e=h=x,c&&(q=ua(),k=a.apply(n,f))):e=Aa(p,c)},m=function(){e&&Za(e);d=e=h=x;if(l||w!==b)q=ua(),k=a.apply(n,f)};return function(){f=arguments;t=ua();n=this;h=l&&(e||!u);if(!1===w)var c=u&&!e;else{d||u||(q=t);var ta=w-(t-q);0>=ta?(d&&(d=Za(d)),q=t,k=a.apply(n,f)):d||(d=Aa(m,ta))}e||
b===w||(e=Aa(p,b));c&&(k=a.apply(n,f));return k}}function zb(a){if(!G(a))throw new W;var b=X.call(arguments,1);return Aa(function(){a.apply(x,b)},1)}function Oa(a){return a}function Ab(a,b){var c=a,f=!b||G(c);b||(c=ba,b=a,a=m);L(Ga(b),function(d){var k=a[d]=b[d];f&&(c.prototype[d]=function(){var b=this.__wrapped__,f=[b];ra.apply(f,arguments);f=k.apply(a,f);if(b&&"object"==typeof b&&b===f)return this;f=new c(f);f.__chain__=this.__chain__;return f})})}function Wa(a,b,c){var f=null==a,d=null==b;null==
c&&("boolean"==typeof a&&d?(c=a,a=1):d||"boolean"!=typeof b||(c=b,d=!0));f&&d&&(b=1);a=+a||0;d?(b=a,a=0):b=+b||0;f=Mb();return c||a%1||b%1?za(a+f*(b-a+parseFloat("1e-"+((f+"").length-1))),b):a+Nb(f*(b-a+1))}function Bb(){return this.__wrapped__}c=c?oa.defaults(va.Object(),c,oa.pick(va,I)):va;var P=c.Array,Ob=c.Boolean,$a=c.Date,La=c.Function,Ba=c.Math,Pb=c.Number,wa=c.Object,Ca=c.RegExp,qa=c.String,W=c.TypeError,sa=[],ab=wa.prototype,Qb=c._,ha=Ca("^"+qa(ab.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,
".+?")+"$"),Rb=Ba.ceil,Za=c.clearTimeout,Nb=Ba.floor,Hb=La.prototype.toString,Da=ha.test(Da=wa.getPrototypeOf)&&Da,J=ab.hasOwnProperty,ua=ha.test(ua=$a.now)&&ua||function(){return+new $a},ra=sa.push,Cb=c.setImmediate,Aa=c.setTimeout,Db=sa.splice,K=ab.toString,Ib=sa.unshift,Eb=function(){try{var a={},b=ha.test(b=wa.defineProperty)&&b,c=b(a,a,a)&&b}catch(f){}return c}(),na=ha.test(na=K.bind)&&na,Fa=ha.test(Fa=wa.create)&&Fa,bb=ha.test(bb=P.isArray)&&bb,Sb=c.isFinite,Tb=c.isNaN,Ma=ha.test(Ma=wa.keys)&&
Ma,Y=Ba.max,za=Ba.min,cb=c.parseInt,Mb=Ba.random,X=sa.slice,Ub=ha.test(c.attachEvent),Fb=na&&!/\n|true/.test(na+Ub),ga={};ga["[object Array]"]=P;ga["[object Boolean]"]=Ob;ga["[object Date]"]=$a;ga["[object Function]"]=La;ga["[object Object]"]=wa;ga["[object Number]"]=Pb;ga["[object RegExp]"]=Ca;ga["[object String]"]=qa;ba.prototype=m.prototype;var ka=m.support={};ka.fastBind=na&&!Fb;ka.funcDecomp=!ha.test(c.WinRTError)&&O.test(y);ka.funcNames="string"==typeof La.name;m.templateSettings={escape:/<%-([\s\S]+?)%>/g,
evaluate:/<%([\s\S]+?)%>/g,interpolate:Q,variable:"",imports:{_:m}};Fa||(Ra=function(a){if(U(a)){n.prototype=a;var b=new n;n.prototype=null}return b||{}});var eb=Eb?function(a,b){w.value=b;Eb(a,"__bindData__",w)}:n,T=bb||function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&"[object Array]"==K.call(a)||!1},Vb=function(a){var b,c=[];if(!a||!D[typeof a])return c;for(b in a)J.call(a,b)&&c.push(b);return c},M=Ma?function(a){return U(a)?Ma(a):[]}:Vb,Sa={"&":"&amp;","<":"&lt;",">":"&gt;",
'"':"&quot;","'":"&#39;"},jb=lb(Sa),Wb=Ca("("+M(jb).join("|")+")","g"),Xb=Ca("["+M(Sa).join("")+"]","g"),Na=function(a,b,c){var f,d=a,k=d;if(!d)return k;var t=arguments,n=0,e="number"==typeof c?2:t.length;if(3<e&&"function"==typeof t[e-2])var h=z(t[--e-1],t[e--],2);else 2<e&&"function"==typeof t[e-1]&&(h=t[--e]);for(;++n<e;)if((d=t[n])&&D[typeof d])for(var q=-1,w=D[typeof d]&&M(d),l=w?w.length:0;++q<l;)f=w[q],k[f]=h?h(k[f],d[f]):d[f];return k},db=function(a,b,c){var f,d=a,k=d;if(!d)return k;for(var t=
arguments,n=0,e="number"==typeof c?2:t.length;++n<e;)if((d=t[n])&&D[typeof d])for(var h=-1,q=D[typeof d]&&M(d),w=q?q.length:0;++h<w;)f=q[h],"undefined"==typeof k[f]&&(k[f]=d[f]);return k},ma=function(a,b,c){var f;if(!a||!D[typeof a])return a;b=b&&"undefined"==typeof c?b:z(b,c,3);for(f in a)if(!1===b(a[f],f,a))break;return a},H=function(a,b,c){if(!a||!D[typeof a])return a;b=b&&"undefined"==typeof c?b:z(b,c,3);for(var f=-1,d=D[typeof a]&&M(a),k=d?d.length:0;++f<k&&(c=d[f],!1!==b(a[c],c,a)););return a},
Pa=function(a){if(!a||"[object Object]"!=K.call(a))return!1;var b=a.valueOf,c="function"==typeof b&&(c=Da(b))&&Da(c);return c?a==c||Da(a)==c:Kb(a)},Yb=Qa(function(a,b,c){J.call(a,c)?a[c]++:a[c]=1}),Zb=Qa(function(a,b,c){(J.call(a,c)?a[c]:a[c]=[]).push(b)}),$b=Qa(function(a,b,c){a[c]=b});Fb&&Gb&&"function"==typeof Cb&&(zb=function(a){if(!G(a))throw new W;return Cb.apply(c,arguments)});var ac=8==cb(" \t\x0B\f\u00a0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u300008")?
cb:function(a,b){return cb(ya(a)?a.replace(ea,""):a,b||0)};m.after=function(a,b){if(!G(b))throw new W;return function(){if(1>--a)return b.apply(this,arguments)}};m.assign=Na;m.at=function(a){for(var b=arguments,c=-1,f=R(b,!0,!1,1),b=b[2]&&b[2][b[1]]===a?1:f.length,d=P(b);++c<b;)d[c]=a[f[c]];return d};m.bind=fb;m.bindAll=function(a){for(var b=1<arguments.length?R(arguments,!0,!1,1):Ga(a),c=-1,f=b.length;++c<f;){var d=b[c];a[d]=da(a[d],1,null,null,a)}return a};m.bindKey=function(a,b){return 2<arguments.length?
da(b,19,X.call(arguments,2),null,a):da(b,3,null,null,a)};m.chain=function(a){a=new ba(a);a.__chain__=!0;return a};m.compact=function(a){for(var b=-1,c=a?a.length:0,f=[];++b<c;){var d=a[b];d&&f.push(d)}return f};m.compose=function(){for(var a=arguments,b=a.length;b--;)if(!G(a[b]))throw new W;return function(){for(var b=arguments,c=a.length;c--;)b=[a[c].apply(this,b)];return b[0]}};m.countBy=Yb;m.createCallback=function(a,b,c){var f=typeof a;if(null==a||"function"==f)return z(a,b,c);if("object"!=f)return function(b){return b[a]};
var d=M(a),k=d[0],t=a[k];return 1!=d.length||t!==t||U(t)?function(b){for(var c=d.length,f=!1;c--&&(f=aa(b[d[c]],a[d[c]],null,!0)););return f}:function(a){a=a[k];return t===a&&(0!==t||1/t==1/a)}};m.curry=function(a,b){b="number"==typeof b?b:+b||a.length;return da(a,4,null,null,null,b)};m.debounce=yb;m.defaults=db;m.defer=zb;m.delay=function(a,b){if(!G(a))throw new W;var c=X.call(arguments,2);return Aa(function(){a.apply(x,c)},b)};m.difference=tb;m.filter=Ia;m.flatten=function(a,b,c,f){"boolean"!=typeof b&&
null!=b&&(c=(f=c)&&f[b]===a?null:b,b=!1);null!=c&&(a=Ka(a,c,f));return R(a,b)};m.forEach=L;m.forEachRight=Ja;m.forIn=ma;m.forInRight=function(a,b,c){var f=[];ma(a,function(a,b){f.push(b,a)});var d=f.length;for(b=z(b,c,3);d--&&!1!==b(f[d--],f[d],a););return a};m.forOwn=H;m.forOwnRight=kb;m.functions=Ga;m.groupBy=Zb;m.indexBy=$b;m.initial=function(a,b,c){var f=0,d=a?a.length:0;if("number"!=typeof b&&null!=b){var k=d;for(b=m.createCallback(b,c,3);k--&&b(a[k],k,a);)f++}else f=null==b||c?1:b||f;return v(a,
0,za(Y(0,d-f),d))};m.intersection=function(c){for(var f=arguments,d=f.length,k=-1,t=h(),n=-1,e=xa(),w=c?c.length:0,p=[],m=h();++k<d;){var D=f[k];t[k]=e===a&&75<=(D?D.length:0)&&l(k?f[k]:m)}a:for(;++n<w;){var r=t[0],D=c[n];if(0>(r?b(r,D):e(m,D))){k=d;for((r||m).push(D);--k;)if(r=t[k],0>(r?b(r,D):e(f[k],D)))continue a;p.push(D)}}for(;d--;)(r=t[d])&&q(r);u(t);u(m);return p};m.invert=lb;m.invoke=function(a,b){var c=X.call(arguments,2),f=-1,d="function"==typeof b,k=a?a.length:0,t=P("number"==typeof k?
k:0);L(a,function(a){t[++f]=(d?b:a[b]).apply(a,c)});return t};m.keys=M;m.map=Ka;m.max=pb;m.memoize=function(a,b){if(!G(a))throw new W;var c=function(){var f=c.cache,d=b?b.apply(this,arguments):F+arguments[0];return J.call(f,d)?f[d]:f[d]=a.apply(this,arguments)};c.cache={};return c};m.merge=function(a){var b=arguments,c=2;if(!U(a))return a;"number"!=typeof b[2]&&(c=b.length);if(3<c&&"function"==typeof b[c-2])var f=z(b[--c-1],b[c--],2);else 2<c&&"function"==typeof b[c-1]&&(f=b[--c]);for(var b=X.call(arguments,
1,c),d=-1,k=h(),t=h();++d<c;)ia(a,b[d],f,k,t);u(k);u(t);return a};m.min=function(a,b,c){var f=Infinity,k=f;if(!b&&T(a)){c=-1;for(var t=a.length;++c<t;){var n=a[c];n<k&&(k=n)}}else b=!b&&ya(a)?d:m.createCallback(b,c,3),L(a,function(a,c,d){c=b(a,c,d);c<f&&(f=c,k=a)});return k};m.omit=function(a,b,c){var f=xa(),d="function"==typeof b,k={};if(d)b=m.createCallback(b,c,3);else var t=R(arguments,!0,!1,1);ma(a,function(a,c,n){if(d?!b(a,c,n):0>f(t,c))k[c]=a});return k};m.once=function(a){var b,c;if(!G(a))throw new W;
return function(){if(b)return c;b=!0;c=a.apply(this,arguments);a=null;return c}};m.pairs=function(a){for(var b=-1,c=M(a),f=c.length,d=P(f);++b<f;){var k=c[b];d[b]=[k,a[k]]}return d};m.partial=function(a){return da(a,16,X.call(arguments,1))};m.partialRight=function(a){return da(a,32,null,X.call(arguments,1))};m.pick=function(a,b,c){var f={};if("function"!=typeof b)for(var d=-1,k=R(arguments,!0,!1,1),t=U(a)?k.length:0;++d<t;){var n=k[d];n in a&&(f[n]=a[n])}else b=m.createCallback(b,c,3),ma(a,function(a,
c,d){b(a,c,d)&&(f[c]=a)});return f};m.pluck=Ua;m.pull=function(a){for(var b=arguments,c=0,f=b.length,d=a?a.length:0;++c<f;)for(var k=-1,t=b[c];++k<d;)a[k]===t&&(Db.call(a,k--,1),d--);return a};m.range=function(a,b,c){a=+a||0;c="number"==typeof c?c:+c||1;null==b&&(b=a,a=0);var f=-1;b=Y(0,Rb((b-a)/(c||1)));for(var d=P(b);++f<b;)d[f]=a,a+=c;return d};m.reject=function(a,b,c){b=m.createCallback(b,c,3);return Ia(a,function(a,c,f){return!b(a,c,f)})};m.remove=function(a,b,c){var f=-1,d=a?a.length:0,k=[];
for(b=m.createCallback(b,c,3);++f<d;)c=a[f],b(c,f,a)&&(k.push(c),Db.call(a,f--,1),d--);return k};m.rest=Ya;m.shuffle=rb;m.sortBy=function(a,b,c){var f=-1,d=a?a.length:0,k=P("number"==typeof d?d:0);b=m.createCallback(b,c,3);L(a,function(a,c,d){var t=k[++f]=r();t.criteria=b(a,c,d);t.index=f;t.value=a});d=k.length;for(k.sort(e);d--;)a=k[d],k[d]=a.value,q(a);return k};m.tap=function(a,b){b(a);return a};m.throttle=function(a,b,c){var f=!0,d=!0;if(!G(a))throw new W;!1===c?f=!1:U(c)&&(f="leading"in c?c.leading:
f,d="trailing"in c?c.trailing:d);t.leading=f;t.maxWait=b;t.trailing=d;return yb(a,b,t)};m.times=function(a,b,c){a=-1<(a=+a)?a:0;var f=-1,d=P(a);for(b=z(b,c,1);++f<a;)d[f]=b(f);return d};m.toArray=function(a){return a&&"number"==typeof a.length?v(a):Ha(a)};m.transform=function(a,b,c,f){var d=T(a);b=z(b,f,4);null==c&&(d?c=[]:(f=a&&a.constructor,c=Ra(f&&f.prototype)));(d?L:H)(a,function(a,f,d){return b(c,a,f,d)});return c};m.union=function(a){return hb(R(arguments,!0,!0))};m.uniq=vb;m.values=Ha;m.where=
Ia;m.without=function(a){return tb(a,X.call(arguments,1))};m.wrap=function(a,b){if(!G(b))throw new W;return function(){var c=[a];ra.apply(c,arguments);return b.apply(this,c)}};m.zip=wb;m.zipObject=xb;m.collect=Ka;m.drop=Ya;m.each=L;m.eachRight=Ja;m.extend=Na;m.methods=Ga;m.object=xb;m.select=Ia;m.tail=Ya;m.unique=vb;m.unzip=wb;Ab(m);m.clone=function(a,b,c,f){"boolean"!=typeof b&&null!=b&&(f=c,c=b,b=!1);return A(a,b,"function"==typeof c&&z(c,f,1))};m.cloneDeep=function(a,b,c){return A(a,!0,"function"==
typeof b&&z(b,c,1))};m.contains=nb;m.escape=function(a){return null==a?"":qa(a).replace(Xb,Jb)};m.every=ob;m.find=Ta;m.findIndex=function(a,b,c){var f=-1,d=a?a.length:0;for(b=m.createCallback(b,c,3);++f<d;)if(b(a[f],f,a))return f;return-1};m.findKey=function(a,b,c){var f;b=m.createCallback(b,c,3);H(a,function(a,c,d){if(b(a,c,d))return f=c,!1});return f};m.findLast=function(a,b,c){var f;b=m.createCallback(b,c,3);Ja(a,function(a,c,d){if(b(a,c,d))return f=a,!1});return f};m.findLastIndex=function(a,
b,c){var f=a?a.length:0;for(b=m.createCallback(b,c,3);f--;)if(b(a[f],f,a))return f;return-1};m.findLastKey=function(a,b,c){var f;b=m.createCallback(b,c,3);kb(a,function(a,c,d){if(b(a,c,d))return f=c,!1});return f};m.has=function(a,b){return a?J.call(a,b):!1};m.identity=Oa;m.indexOf=ib;m.isArguments=gb;m.isArray=T;m.isBoolean=function(a){return!0===a||!1===a||"[object Boolean]"==K.call(a)};m.isDate=function(a){return a?"object"==typeof a&&"[object Date]"==K.call(a):!1};m.isElement=function(a){return a?
1===a.nodeType:!1};m.isEmpty=function(a){var b=!0;if(!a)return b;var c=K.call(a),f=a.length;if("[object Array]"==c||"[object String]"==c||"[object Arguments]"==c||"[object Object]"==c&&"number"==typeof f&&G(a.splice))return!f;H(a,function(){return b=!1});return b};m.isEqual=function(a,b,c,f){return aa(a,b,"function"==typeof c&&z(c,f,2))};m.isFinite=function(a){return Sb(a)&&!Tb(parseFloat(a))};m.isFunction=G;m.isNaN=function(a){return mb(a)&&a!=+a};m.isNull=function(a){return null===a};m.isNumber=
mb;m.isObject=U;m.isPlainObject=Pa;m.isRegExp=function(a){return a?"object"==typeof a&&"[object RegExp]"==K.call(a):!1};m.isString=ya;m.isUndefined=function(a){return"undefined"==typeof a};m.lastIndexOf=function(a,b,c){var f=a?a.length:0;for("number"==typeof c&&(f=(0>c?Y(0,f+c):za(c,f-1))+1);f--;)if(a[f]===b)return f;return-1};m.mixin=Ab;m.noConflict=function(){c._=Qb;return this};m.parseInt=ac;m.random=Wa;m.reduce=Va;m.reduceRight=qb;m.result=function(a,b){if(a){var c=a[b];return G(c)?a[b]():c}};
m.runInContext=y;m.size=function(a){var b=a?a.length:0;return"number"==typeof b?b:M(a).length};m.some=sb;m.sortedIndex=ub;m.template=function(a,b,c){var f=m.templateSettings;a||(a="");c=db({},c,f);var d=db({},c.imports,f.imports),f=M(d),d=Ha(d),t,n=0,e=c.interpolate||N,h="__p += '",e=Ca((c.escape||N).source+"|"+e.source+"|"+(e===Q?Ea:N).source+"|"+(c.evaluate||N).source+"|$","g");a.replace(e,function(b,c,f,d,k,e){f||(f=d);h+=a.slice(n,e).replace(pa,p);c&&(h+="' +\n__e("+c+") +\n'");k&&(t=!0,h+="';\n"+
k+";\n__p += '");f&&(h+="' +\n((__t = ("+f+")) == null ? '' : __t) +\n'");n=e+b.length;return b});var h=h+"';\n",q=e=c.variable;q||(e="obj",h="with ("+e+") {\n"+h+"\n}\n");h=(t?h.replace(E,""):h).replace(k,"$1").replace(S,"$1;");h="function("+e+") {\n"+(q?"":e+" || ("+e+" = {});\n")+"var __t, __p = '', __e = _.escape"+(t?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+h+"return __p\n}";c="\n/*\n//# sourceURL="+(c.sourceURL||"/lodash/template/source["+
Z++ +"]")+"\n*/";try{var w=La(f,"return "+h+c).apply(x,d)}catch(l){throw l.source=h,l;}if(b)return w(b);w.source=h;return w};m.unescape=function(a){return null==a?"":qa(a).replace(Wb,Lb)};m.uniqueId=function(a){var b=++B;return qa(null==a?"":a)+b};m.all=ob;m.any=sb;m.detect=Ta;m.findWhere=Ta;m.foldl=Va;m.foldr=qb;m.include=nb;m.inject=Va;H(m,function(a,b){m.prototype[b]||(m.prototype[b]=function(){var b=[this.__wrapped__],c=this.__chain__;ra.apply(b,arguments);b=a.apply(m,b);return c?new ba(b,c):
b})});m.first=Xa;m.last=function(a,b,c){var f=0,d=a?a.length:0;if("number"!=typeof b&&null!=b){var k=d;for(b=m.createCallback(b,c,3);k--&&b(a[k],k,a);)f++}else if(f=b,null==f||c)return a?a[d-1]:x;return v(a,Y(0,d-f))};m.sample=function(a,b,c){var f=a?a.length:0;"number"!=typeof f&&(a=Ha(a));if(null==b||c)return a?a[Wa(f-1)]:x;a=rb(a);a.length=za(Y(0,b),a.length);return a};m.take=Xa;m.head=Xa;H(m,function(a,b){var c="sample"!==b;m.prototype[b]||(m.prototype[b]=function(b,f){var d=this.__chain__,k=
a(this.__wrapped__,b,f);return d||null!=b&&(!f||c&&"function"==typeof b)?new ba(k,d):k})});m.VERSION="2.2.1";m.prototype.chain=function(){this.__chain__=!0;return this};m.prototype.toString=function(){return qa(this.__wrapped__)};m.prototype.value=Bb;m.prototype.valueOf=Bb;L(["join","pop","shift"],function(a){var b=sa[a];m.prototype[a]=function(){var a=this.__chain__,c=b.apply(this.__wrapped__,arguments);return a?new ba(c,a):c}});L(["push","reverse","sort","unshift"],function(a){var b=sa[a];m.prototype[a]=
function(){b.apply(this.__wrapped__,arguments);return this}});L(["concat","slice","splice"],function(a){var b=sa[a];m.prototype[a]=function(){return new ba(b.apply(this.__wrapped__,arguments),this.__chain__)}});return m}var x,A=[],z=[],B=0,F=+new Date+"",E=/\b__p \+= '';/g,k=/\b(__p \+=) '' \+/g,S=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Ea=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ca=/\w*$/,la=/^function[ \n\r\t]+\w/,Q=/<%=([\s\S]+?)%>/g,ea=RegExp("^[ \t\x0B\f\u00a0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]*0+(?=.$)"),
N=/($^)/,O=/\bthis\b/,pa=/['\n\r\t\u2028\u2029\\]/g,I="Array Boolean Date Function Math Number Object RegExp String _ attachEvent clearTimeout isFinite isNaN parseInt setImmediate setTimeout".split(" "),Z=0,f={"[object Function]":!1};f["[object Arguments]"]=f["[object Array]"]=f["[object Boolean]"]=f["[object Date]"]=f["[object Number]"]=f["[object Object]"]=f["[object RegExp]"]=f["[object String]"]=!0;var t={leading:!1,maxWait:0,trailing:!1},w={configurable:!1,enumerable:!1,value:null,writable:!1},
D={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},ba={"\\":"\\","'":"'","\n":"n","\r":"r","\t":"t","\u2028":"u2028","\u2029":"u2029"},va=D[typeof window]&&window||this,R=D[typeof exports]&&exports&&!exports.nodeType&&exports,aa=D[typeof module]&&module&&!module.nodeType&&module,Gb=aa&&aa.exports===R&&R,ia=D[typeof global]&&global;!ia||ia.global!==ia&&ia.window!==ia||(va=ia);var oa=y();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(va._=oa,define(function(){return oa})):
R&&aa?Gb?(aa.exports=oa)._=oa:R._=oa:va._=oa}).call(this);
(function(){var a=this,b=a.Backbone,c=[],d=c.push,e=c.slice,l=c.splice,p;p="undefined"!==typeof exports?exports:a.Backbone={};p.VERSION="1.0.0";var h=a._;h||"undefined"===typeof require||(h=require("underscore"));p.$=a.jQuery||a.Zepto||a.ender||a.$;p.noConflict=function(){a.Backbone=b;return this};p.emulateHTTP=!1;p.emulateJSON=!1;var r=p.Events={on:function(a,b,c){if(!u(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});(this._events[a]||(this._events[a]=[])).push({callback:b,context:c,
ctx:c||this});return this},once:function(a,b,c){if(!u(this,"once",a,[b,c])||!b)return this;var d=this,k=h.once(function(){d.off(a,k);b.apply(this,arguments)});k._callback=b;return this.on(a,k,c)},off:function(a,b,c){var d,k,n,e,q,l,p,r;if(!this._events||!u(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events={},this;e=a?[a]:h.keys(this._events);q=0;for(l=e.length;q<l;q++)if(a=e[q],n=this._events[a]){this._events[a]=d=[];if(b||c)for(p=0,r=n.length;p<r;p++)k=n[p],(b&&b!==k.callback&&b!==
k.callback._callback||c&&c!==k.context)&&d.push(k);d.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=e.call(arguments,1);if(!u(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;c&&q(c,b);d&&q(d,arguments);return this},stopListening:function(a,b,c){var d=this._listeners;if(!d)return this;var k=!b&&!c;"object"===typeof b&&(c=this);a&&((d={})[a._listenerId]=a);for(var n in d)d[n].off(b,c,this),k&&delete this._listeners[n];return this}},
n=/\s+/,u=function(a,b,c,d){if(!c)return!0;if("object"===typeof c){for(var k in c)a[b].apply(a,[k,c[k]].concat(d));return!1}if(n.test(c)){c=c.split(n);k=0;for(var e=c.length;k<e;k++)a[b].apply(a,[c[k]].concat(d));return!1}return!0},q=function(a,b){var c,d=-1,k=a.length,n=b[0],e=b[1],h=b[2];switch(b.length){case 0:for(;++d<k;)(c=a[d]).callback.call(c.ctx);break;case 1:for(;++d<k;)(c=a[d]).callback.call(c.ctx,n);break;case 2:for(;++d<k;)(c=a[d]).callback.call(c.ctx,n,e);break;case 3:for(;++d<k;)(c=
a[d]).callback.call(c.ctx,n,e,h);break;default:for(;++d<k;)(c=a[d]).callback.apply(c.ctx,b)}};h.each({listenTo:"on",listenToOnce:"once"},function(a,b){r[b]=function(b,c,d){var k=this._listeners||(this._listeners={}),t=b._listenerId||(b._listenerId=h.uniqueId("l"));k[t]=b;"object"===typeof c&&(d=this);b[a](c,d,this);return this}});r.bind=r.on;r.unbind=r.off;h.extend(p,r);var v=p.Model=function(a,b){var c,d=a||{};b||(b={});this.cid=h.uniqueId("c");this.attributes={};h.extend(this,h.pick(b,y));b.parse&&
(d=this.parse(d,b)||{});if(c=h.result(this,"defaults"))d=h.defaults({},d,c);this.set(d,b);this.changed={};this.initialize.apply(this,arguments)},y=["url","urlRoot","collection"];h.extend(v.prototype,r,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return h.clone(this.attributes)},sync:function(){return p.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return h.escape(this.get(a))},has:function(a){return null!=
this.get(a)},set:function(a,b,c){var d,k,n,e,q,l,u;if(null==a)return this;"object"===typeof a?(k=a,c=b):(k={})[a]=b;c||(c={});if(!this._validate(k,c))return!1;n=c.unset;e=c.silent;a=[];q=this._changing;this._changing=!0;q||(this._previousAttributes=h.clone(this.attributes),this.changed={});u=this.attributes;l=this._previousAttributes;this.idAttribute in k&&(this.id=k[this.idAttribute]);for(d in k)b=k[d],h.isEqual(u[d],b)||a.push(d),h.isEqual(l[d],b)?delete this.changed[d]:this.changed[d]=b,n?delete u[d]:
u[d]=b;if(!e)for(a.length&&(this._pending=!0),b=0,d=a.length;b<d;b++)this.trigger("change:"+a[b],this,u[a[b]],c);if(q)return this;if(!e)for(;this._pending;)this._pending=!1,this.trigger("change",this,c);this._changing=this._pending=!1;return this},unset:function(a,b){return this.set(a,void 0,h.extend({},b,{unset:!0}))},clear:function(a){var b={},c;for(c in this.attributes)b[c]=void 0;return this.set(b,h.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!h.isEmpty(this.changed):h.has(this.changed,
a)},changedAttributes:function(a){if(!a)return this.hasChanged()?h.clone(this.changed):!1;var b,c=!1,d=this._changing?this._previousAttributes:this.attributes,k;for(k in a)h.isEqual(d[k],b=a[k])||((c||(c={}))[k]=b);return c},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return h.clone(this._previousAttributes)},fetch:function(a){a=a?h.clone(a):{};void 0===a.parse&&(a.parse=!0);var b=this,c=a.success;a.success=function(d){if(!b.set(b.parse(d,
a),a))return!1;c&&c(b,d,a);b.trigger("sync",b,d,a)};Z(this,a);return this.sync("read",this,a)},save:function(a,b,c){var d,k=this.attributes;null==a||"object"===typeof a?(d=a,c=b):(d={})[a]=b;if(!(!d||c&&c.wait||this.set(d,c)))return!1;c=h.extend({validate:!0},c);if(!this._validate(d,c))return!1;d&&c.wait&&(this.attributes=h.extend({},k,d));void 0===c.parse&&(c.parse=!0);var n=this,e=c.success;c.success=function(a){n.attributes=k;var b=n.parse(a,c);c.wait&&(b=h.extend(d||{},b));if(h.isObject(b)&&!n.set(b,
c))return!1;e&&e(n,a,c);n.trigger("sync",n,a,c)};Z(this,c);a=this.isNew()?"create":c.patch?"patch":"update";"patch"===a&&(c.attrs=d);a=this.sync(a,this,c);d&&c.wait&&(this.attributes=k);return a},destroy:function(a){a=a?h.clone(a):{};var b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};a.success=function(k){(a.wait||b.isNew())&&d();c&&c(b,k,a);b.isNew()||b.trigger("sync",b,k,a)};if(this.isNew())return a.success(),!1;Z(this,a);var k=this.sync("delete",this,a);a.wait||d();return k},
url:function(){var a=h.result(this,"urlRoot")||h.result(this.collection,"url")||I();return this.isNew()?a:a+("/"===a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(a){return this._validate({},h.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=h.extend({},this.attributes,a);var c=this.validationError=
this.validate(a,b)||null;if(!c)return!0;this.trigger("invalid",this,c,h.extend(b||{},{validationError:c}));return!1}});h.each("keys values pairs invert pick omit".split(" "),function(a){v.prototype[a]=function(){var b=e.call(arguments);b.unshift(this.attributes);return h[a].apply(h,b)}});var x=p.Collection=function(a,b){b||(b={});b.url&&(this.url=b.url);b.model&&(this.model=b.model);void 0!==b.comparator&&(this.comparator=b.comparator);this._reset();this.initialize.apply(this,arguments);a&&this.reset(a,
h.extend({silent:!0},b))},A={add:!0,remove:!0,merge:!0},z={add:!0,merge:!1,remove:!1};h.extend(x.prototype,r,{model:v,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return p.sync.apply(this,arguments)},add:function(a,b){return this.set(a,h.defaults(b||{},z))},remove:function(a,b){a=h.isArray(a)?a.slice():[a];b||(b={});var c,d,k,n;c=0;for(d=a.length;c<d;c++)if(n=this.get(a[c]))delete this._byId[n.id],delete this._byId[n.cid],k=this.indexOf(n),
this.models.splice(k,1),this.length--,b.silent||(b.index=k,n.trigger("remove",n,this,b)),this._removeReference(n);return this},set:function(a,b){b=h.defaults(b||{},A);b.parse&&(a=this.parse(a,b));h.isArray(a)||(a=a?[a]:[]);var c,k,n,e,q,u=b.at,p=this.comparator&&null==u&&!1!==b.sort,r=h.isString(this.comparator)?this.comparator:null,v=[],S=[],m={};c=0;for(k=a.length;c<k;c++)if(n=this._prepareModel(a[c],b))(e=this.get(n))?(b.remove&&(m[e.cid]=!0),b.merge&&(e.set(n.attributes,b),p&&!q&&e.hasChanged(r)&&
(q=!0))):b.add&&(v.push(n),n.on("all",this._onModelEvent,this),this._byId[n.cid]=n,null!=n.id&&(this._byId[n.id]=n));if(b.remove){c=0;for(k=this.length;c<k;++c)m[(n=this.models[c]).cid]||S.push(n);S.length&&this.remove(S,b)}v.length&&(p&&(q=!0),this.length+=v.length,null!=u?l.apply(this.models,[u,0].concat(v)):d.apply(this.models,v));q&&this.sort({silent:!0});if(b.silent)return this;c=0;for(k=v.length;c<k;c++)(n=v[c]).trigger("add",n,this,b);q&&this.trigger("sort",this,b);return this},reset:function(a,
b){b||(b={});for(var c=0,d=this.models.length;c<d;c++)this._removeReference(this.models[c]);b.previousModels=this.models;this._reset();this.add(a,h.extend({silent:!0},b));b.silent||this.trigger("reset",this,b);return this},push:function(a,b){a=this._prepareModel(a,b);this.add(a,h.extend({at:this.length},b));return a},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,b){a=this._prepareModel(a,b);this.add(a,h.extend({at:0},b));return a},shift:function(a){var b=
this.at(0);this.remove(b,a);return b},slice:function(a,b){return this.models.slice(a,b)},get:function(a){return null==a?void 0:this._byId[null!=a.id?a.id:a.cid||a]},at:function(a){return this.models[a]},where:function(a,b){return h.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw Error("Cannot sort a set without a comparator");a||(a={});h.isString(this.comparator)||
1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(h.bind(this.comparator,this));a.silent||this.trigger("sort",this,a);return this},sortedIndex:function(a,b,c){b||(b=this.comparator);var d=h.isFunction(b)?b:function(a){return a.get(b)};return h.sortedIndex(this.models,a,d,c)},pluck:function(a){return h.invoke(this.models,"get",a)},fetch:function(a){a=a?h.clone(a):{};void 0===a.parse&&(a.parse=!0);var b=a.success,c=this;a.success=function(d){c[a.reset?"reset":
"set"](d,a);b&&b(c,d,a);c.trigger("sync",c,d,a)};Z(this,a);return this.sync("read",this,a)},create:function(a,b){b=b?h.clone(b):{};if(!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var c=this,d=b.success;b.success=function(k){b.wait&&c.add(a,b);d&&d(a,k,b)};a.save(null,b);return a},parse:function(a,b){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(a,b){if(a instanceof v)return a.collection||
(a.collection=this),a;b||(b={});b.collection=this;var c=new this.model(a,b);return c._validate(a,b)?c:(this.trigger("invalid",this,a,b),!1)},_removeReference:function(a){this===a.collection&&delete a.collection;a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){if("add"!==a&&"remove"!==a||c===this)"destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments)}});h.each("forEach each map collect reduce foldl inject reduceRight foldr find detect filter select reject every all some any include contains invoke max min toArray size first head take initial rest tail drop last without indexOf shuffle lastIndexOf isEmpty chain".split(" "),
function(a){x.prototype[a]=function(){var b=e.call(arguments);b.unshift(this.models);return h[a].apply(h,b)}});h.each(["groupBy","countBy","sortBy"],function(a){x.prototype[a]=function(b,c){var d=h.isFunction(b)?b:function(a){return a.get(b)};return h[a](this.models,d,c)}});var c=p.View=function(a){this.cid=h.uniqueId("view");this._configure(a||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()},B=/^(\S+)\s*(.*)$/,F="model collection el id attributes className tagName events".split(" ");
h.extend(c.prototype,r,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(a,b){this.$el&&this.undelegateEvents();this.$el=a instanceof p.$?a:p.$(a);this.el=this.$el[0];!1!==b&&this.delegateEvents();return this},delegateEvents:function(a){if(!a&&!(a=h.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var c=a[b];h.isFunction(c)||
(c=this[a[b]]);if(c){var d=b.match(B),k=d[1],d=d[2],c=h.bind(c,this),k=k+(".delegateEvents"+this.cid);if(""===d)this.$el.on(k,c);else this.$el.on(k,d,c)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_configure:function(a){this.options&&(a=h.extend({},h.result(this,"options"),a));h.extend(this,h.pick(a,F));this.options=a},_ensureElement:function(){if(this.el)this.setElement(h.result(this,"el"),!1);else{var a=h.extend({},h.result(this,"attributes"));
this.id&&(a.id=h.result(this,"id"));this.className&&(a["class"]=h.result(this,"className"));a=p.$("<"+h.result(this,"tagName")+">").attr(a);this.setElement(a,!1)}}});p.sync=function(a,b,c){var d=E[a];h.defaults(c||(c={}),{emulateHTTP:p.emulateHTTP,emulateJSON:p.emulateJSON});var k={type:d,dataType:"json"};c.url||(k.url=h.result(b,"url")||I());null!=c.data||!b||"create"!==a&&"update"!==a&&"patch"!==a||(k.contentType="application/json",k.data=JSON.stringify(c.attrs||b.toJSON(c)));c.emulateJSON&&(k.contentType=
"application/x-www-form-urlencoded",k.data=k.data?{model:k.data}:{});if(c.emulateHTTP&&("PUT"===d||"DELETE"===d||"PATCH"===d)){k.type="POST";c.emulateJSON&&(k.data._method=d);var n=c.beforeSend;c.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",d);if(n)return n.apply(this,arguments)}}"GET"===k.type||c.emulateJSON||(k.processData=!1);"PATCH"!==k.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(k.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});
a=c.xhr=p.ajax(h.extend(k,c));b.trigger("request",b,a,c);return a};var E={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};p.ajax=function(){return p.$.ajax.apply(p.$,arguments)};var k=p.Router=function(a){a||(a={});a.routes&&(this.routes=a.routes);this._bindRoutes();this.initialize.apply(this,arguments)},S=/\((.*?)\)/g,Ea=/(\(\?)?:\w+/g,ca=/\*\w+/g,la=/[\-{}\[\]+?.,\\\^$|#\s]/g;h.extend(k.prototype,r,{initialize:function(){},route:function(a,b,c){h.isRegExp(a)||(a=this._routeToRegExp(a));
h.isFunction(b)&&(c=b,b="");c||(c=this[b]);var d=this;p.history.route(a,function(k){k=d._extractParameters(a,k);c&&c.apply(d,k);d.trigger.apply(d,["route:"+b].concat(k));d.trigger("route",b,k);p.history.trigger("route",d,b,k)});return this},navigate:function(a,b){p.history.navigate(a,b);return this},_bindRoutes:function(){if(this.routes){this.routes=h.result(this,"routes");for(var a,b=h.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){a=a.replace(la,"\\$&").replace(S,
"(?:$1)?").replace(Ea,function(a,b){return b?a:"([^/]+)"}).replace(ca,"(.*?)");return new RegExp("^"+a+"$")},_extractParameters:function(a,b){var c=a.exec(b).slice(1);return h.map(c,function(a){return a?decodeURIComponent(a):null})}});var Q=p.History=function(){this.handlers=[];h.bindAll(this,"checkUrl");"undefined"!==typeof window&&(this.location=window.location,this.history=window.history)},ea=/^[#\/]|\s+$/g,N=/^\/+|\/+$/g,O=/msie [\w.]+/,pa=/\/$/;Q.started=!1;h.extend(Q.prototype,r,{interval:50,
getHash:function(a){return(a=(a||this).location.href.match(/#(.*)$/))?a[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=this.location.pathname;var c=this.root.replace(pa,"");a.indexOf(c)||(a=a.substr(c.length))}else a=this.getHash();return a.replace(ea,"")},start:function(a){if(Q.started)throw Error("Backbone.history has already been started");Q.started=!0;this.options=h.extend({},{root:"/"},this.options,a);this.root=this.options.root;this._wantsHashChange=
!1!==this.options.hashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);a=this.getFragment();var b=document.documentMode,b=O.exec(navigator.userAgent.toLowerCase())&&(!b||7>=b);this.root=("/"+this.root+"/").replace(N,"/");b&&this._wantsHashChange&&(this.iframe=p.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(a));if(this._hasPushState)p.$(window).on("popstate",
this.checkUrl);else if(this._wantsHashChange&&"onhashchange"in window&&!b)p.$(window).on("hashchange",this.checkUrl);else this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval));this.fragment=a;a=this.location;b=a.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!b)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&
this._hasPushState&&b&&a.hash&&(this.fragment=this.getHash().replace(ea,""),this.history.replaceState({},document.title,this.root+this.fragment+a.search));if(!this.options.silent)return this.loadUrl()},stop:function(){p.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);Q.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){a=this.getFragment();a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe)));
if(a===this.fragment)return!1;this.iframe&&this.navigate(a);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(a){var b=this.fragment=this.getFragment(a);return h.any(this.handlers,function(a){if(a.route.test(b))return a.callback(b),!0})},navigate:function(a,b){if(!Q.started)return!1;b&&!0!==b||(b={trigger:b});a=this.getFragment(a||"");if(this.fragment!==a){this.fragment=a;var c=this.root+a;if(this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else if(this._wantsHashChange)this._updateHash(this.location,
a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace));else return this.location.assign(c);b.trigger&&this.loadUrl(a)}},_updateHash:function(a,b,c){c?(c=a.href.replace(/(javascript:|#).*$/,""),a.replace(c+"#"+b)):a.hash="#"+b}});p.history=new Q;v.extend=x.extend=k.extend=c.extend=Q.extend=function(a,b){var c=this,d;d=a&&h.has(a,"constructor")?a.constructor:function(){return c.apply(this,
arguments)};h.extend(d,c,b);var k=function(){this.constructor=d};k.prototype=c.prototype;d.prototype=new k;a&&h.extend(d.prototype,a);d.__super__=c.prototype;return d};var I=function(){throw Error('A "url" property or function must be specified');},Z=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b);a.trigger("error",a,d,b)}}}).call(this);
(function(a,b){"function"===typeof define&&define.amd?define([],b):a.Vectorizer=a.V=b()})(this,function(){function a(a,b,c){-1<b.indexOf(":")?(b=b.split(":"),a.setAttributeNS(l[b[0]],b[1],c)):"id"===b?a.id=c:a.setAttribute(b,c)}function b(a){var b,c,d;if(a){var e=a.match(/translate\((.*)\)/);e&&(b=e[1].split(","));(e=a.match(/rotate\((.*)\)/))&&(c=e[1].split(","));(a=a.match(/scale\((.*)\)/))&&(d=a[1].split(","))}a=d&&d[0]?parseFloat(d[0]):1;return{translate:{tx:b&&b[0]?parseInt(b[0],10):0,ty:b&&
b[1]?parseInt(b[1],10):0},rotate:{angle:c&&c[0]?parseInt(c[0],10):0,cx:c&&c[1]?parseInt(c[1],10):void 0,cy:c&&c[2]?parseInt(c[2],10):void 0},scale:{sx:a,sy:d&&d[1]?parseFloat(d[1]):a}}}function c(a,b){return{x:b.x*a.a+b.y*a.c+0,y:b.x*a.b+b.y*a.d+0}}function d(a){var b=c(a,{x:0,y:1}),d=c(a,{x:1,y:0}),b=180/Math.PI*Math.atan2(b.y,b.x)-90,d=180/Math.PI*Math.atan2(d.y,d.x);return{translateX:a.e,translateY:a.f,scaleX:Math.sqrt(a.a*a.a+a.b*a.b),scaleY:Math.sqrt(a.c*a.c+a.d*a.d),skewX:b,skewY:d,rotation:b}}
function e(a){this.node=a;this.node.id||(this.node.id="v-"+(++p+""))}window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1");var l={xmlns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"},p=0;e.prototype={translate:function(a,c){c=c||0;var d=this.attr("transform")||"",e=b(d);if("undefined"===typeof a)return e.translate;d=d.replace(/translate\([^\)]*\)/g,"").trim();this.attr("transform","translate("+(e.translate.tx+a)+","+(e.translate.ty+
c)+") "+d);return this},rotate:function(a,c,d){var e=this.attr("transform")||"",h=b(e);if("undefined"===typeof a)return h.rotate;e=e.replace(/rotate\([^\)]*\)/g,"").trim();this.attr("transform",e+" rotate("+(h.rotate.angle+a%360)+(void 0!==c&&void 0!==d?","+c+","+d:"")+")");return this},scale:function(a,c){c="undefined"===typeof c?a:c;var d=this.attr("transform")||"",e=b(d);if("undefined"===typeof a)return e.scale;d=d.replace(/scale\([^\)]*\)/g,"").trim();this.attr("transform",d+" scale("+a+","+c+
")");return this},bbox:function(a,b){if(!this.node.ownerSVGElement)return{x:0,y:0,width:0,height:0};var c;try{c=this.node.getBBox(),c={x:c.x|0,y:c.y|0,width:c.width|0,height:c.height|0}}catch(d){c={x:this.node.clientLeft,y:this.node.clientTop,width:this.node.clientWidth,height:this.node.clientHeight}}if(a)return c;var e=this.node.getTransformToElement(b||this.node.ownerSVGElement),h=[],l=this.node.ownerSVGElement.createSVGPoint();l.x=c.x;l.y=c.y;h.push(l.matrixTransform(e));l.x=c.x+c.width;l.y=c.y;
h.push(l.matrixTransform(e));l.x=c.x+c.width;l.y=c.y+c.height;h.push(l.matrixTransform(e));l.x=c.x;l.y=c.y+c.height;h.push(l.matrixTransform(e));for(var e=c=h[0].x,p=l=h[0].y,r=1,F=h.length;r<F;r++){var E=h[r].x,k=h[r].y;E<c?c=E:E>e&&(e=E);k<l?l=k:k>p&&(p=k)}return{x:c,y:l,width:e-c,height:p-l}},text:function(a){var b=a.split("\n"),c=0;this.attr("y","0.8em");this.attr("display",a?null:"none");if(1===b.length)return this.node.textContent=a,this;for(this.node.textContent="";c<b.length;c++)a=h("tspan",
{dy:0==c?"0em":"1em",x:this.attr("x")||0}),a.node.textContent=b[c],this.append(a);return this},attr:function(b,c){if("string"===typeof b&&"undefined"===typeof c)return this.node.getAttribute(b);if("object"===typeof b)for(var d in b)b.hasOwnProperty(d)&&a(this.node,d,b[d]);else a(this.node,b,c);return this},remove:function(){this.node.parentNode&&this.node.parentNode.removeChild(this.node)},append:function(a){var b=a;"[object Array]"!==Object.prototype.toString.call(a)&&(b=[a]);for(var c=0,d=b.length;c<
d;c++)a=b[c],this.node.appendChild(a instanceof e?a.node:a);return this},prepend:function(a){this.node.insertBefore(a instanceof e?a.node:a,this.node.firstChild)},svg:function(){return this.node instanceof window.SVGSVGElement?this:h(this.node.ownerSVGElement)},defs:function(){var a=this.svg().node.getElementsByTagName("defs");return a&&a.length?h(a[0]):void 0},clone:function(){var a=h(this.node.cloneNode(!0));a.node.id="v-"+(++p+"");return a},findOne:function(a){return(a=this.node.querySelector(a))?
h(a):void 0},find:function(a){a=this.node.querySelectorAll(a);for(var b=0,c=a.length;b<c;b++)a[b]=h(a[b]);return a},toLocalPoint:function(a,b){var c=this.svg().node,d=c.createSVGPoint();d.x=a;d.y=b;try{var e=d.matrixTransform(c.getScreenCTM().inverse()),h=this.node.getTransformToElement(c).inverse()}catch(l){return d}return e.matrixTransform(h)},translateCenterToPoint:function(a){var b=this.bbox(),b=g.rect(b).center();this.translate(a.x-b.x,a.y-b.y)},translateAndAutoOrient:function(a,b,c){var e=this.scale();
this.attr("transform","");this.scale(e.sx,e.sy);var h=this.svg().node,l=this.bbox(!1,c),e=h.createSVGTransform();e.setTranslate(-l.x-l.width/2,-l.y-l.height/2);var p=h.createSVGTransform(),r=g.point(a).changeInAngle(a.x-b.x,a.y-b.y,b);p.setRotate(r,0,0);r=h.createSVGTransform();b=g.point(a).move(b,l.width/2);r.setTranslate(a.x+(a.x-b.x),a.y+(a.y-b.y));a=this.node.getTransformToElement(c);c=h.createSVGTransform();c.setMatrix(r.matrix.multiply(p.matrix.multiply(e.matrix.multiply(a))));e=d(c.matrix);
this.translate(e.translateX,e.translateY);this.rotate(e.rotation);return this},animateAlongPath:function(a,b){var c=h("animateMotion",a),d=h("mpath",{"xlink:href":"#"+h(b).node.id});c.append(d);this.append(c);try{c.node.beginElement()}catch(e){if("fake"===document.documentElement.getAttribute("smiling")){c=c.node;c.animators=[];(d=c.getAttribute("id"))&&(id2anim[d]=c);for(var d=getTargets(c),l=0,p=d.length;l<p;l++){var r=new Animator(c,d[l],l);animators.push(r);c.animators[l]=r;r.register()}}}},hasClass:function(a){return(new RegExp("(\\s|^)"+
a+"(\\s|$)")).test(this.node.getAttribute("class"))},addClass:function(a){this.hasClass(a)||this.node.setAttribute("class",this.node.getAttribute("class")+" "+a);return this},removeClass:function(a){var b=this.node.getAttribute("class").replace(new RegExp("(\\s|^)"+a+"(\\s|$)","g"),"$2");this.hasClass(a)&&this.node.setAttribute("class",b);return this},toggleClass:function(a,b){("undefined"===typeof b?this.hasClass(a):!b)?this.removeClass(a):this.addClass(a);return this}};var h=function(b,c,d){if(b){if("object"===
typeof b)return new e(b);c=c||{};if("svg"===b.toLowerCase())c.xmlns=l.xmlns,c["xmlns:xlink"]=l.xlink,c.version="1.1";else if("<"===b[0]){b='<svg xmlns="'+l.xmlns+'" xmlns:xlink="'+l.xlink+'" version="1.1">'+b+"</svg>";d=new DOMParser;d.async=!1;b=d.parseFromString(b,"text/xml").documentElement;if(1<b.childNodes.length){d=[];c=0;for(var h=b.childNodes.length;c<h;c++)d.push(new e(document.importNode(b.childNodes[c],!0)));return d}return new e(document.importNode(b.firstChild,!0))}b=document.createElementNS(l.xmlns,
b);for(h in c)a(b,h,c[h]);"[object Array]"!=Object.prototype.toString.call(d)&&(d=[d]);c=0;for(var h=d[0]&&d.length||0,p;c<h;c++)p=d[c],b.appendChild(p instanceof e?p.node:p);return new e(b)}};h.decomposeMatrix=d;h.rectToPath=function(a){var b=a.rx||a["top-rx"]||0,c=a.rx||a["bottom-rx"]||0,d=a.ry||a["top-ry"]||0,e=a.ry||a["bottom-ry"]||0;return["M",a.x,a.y+d,"v",a.height-d-e,"a",c,e,0,0,0,c,e,"h",a.width-2*c,"a",c,e,0,0,0,c,-e,"v",-(a.height-e-d),"a",b,d,0,0,0,-b,-d,"h",-(a.width-2*b),"a",b,d,0,0,
0,-b,d].join(" ")};var r=h("svg").node;h.createSVGMatrix=function(a){var b=r.createSVGMatrix(),c;for(c in a)b[c]=a[c];return b};h.createSVGTransform=function(){return r.createSVGTransform()};h.createSVGPoint=function(a,b){var c=r.createSVGPoint();c.x=a;c.y=b;return c};return h});
(function(a,b){"function"===typeof define&&define.amd?define([],b):"object"===typeof exports?module.exports=b():a.g=b()})(this,function(){function a(b,c){if(!(this instanceof a))return new a(b,c);var d;void 0===c&&Object(b)!==b?(d=b.split(-1===b.indexOf("@")?" ":"@"),this.x=parseInt(d[0],10),this.y=parseInt(d[1],10)):Object(b)===b?(this.x=b.x,this.y=b.y):(this.x=b,this.y=c)}function b(c,d){if(!(this instanceof b))return new b(c,d);this.start=a(c);this.end=a(d)}function c(a,b,d,e){if(!(this instanceof
c))return new c(a,b,d,e);void 0===b&&(b=a.y,d=a.width,e=a.height,a=a.x);this.x=a;this.y=b;this.width=d;this.height=e}function d(b,c,e){if(!(this instanceof d))return new d(b,c,e);b=a(b);this.x=b.x;this.y=b.y;this.a=c;this.b=e}var e=Math,l=e.abs,p=e.cos,h=e.sin,r=e.sqrt,n=e.min,u=e.max,q=e.atan2,v=e.round,y=e.floor,x=e.PI,A=e.random,z=function(a){return 180*a/x%360},B=function(a){return a%360*x/180},F=function(a,b){return b*Math.round(a/b)},E=function(a){return a%360+(0>a?360:0)};a.prototype={toString:function(){return this.x+
"@"+this.y},adhereToRect:function(a){if(a.containsPoint(this))return this;this.x=n(u(this.x,a.x),a.x+a.width);this.y=n(u(this.y,a.y),a.y+a.height);return this},theta:function(b){b=a(b);var c=-(b.y-this.y);b=b.x-this.x;c=0==c.toFixed(10)&&0==b.toFixed(10)?0:q(c,b);0>c&&(c=2*x+c);return 180*c/x},distance:function(a){return b(this,a).length()},manhattanDistance:function(a){return l(a.x-this.x)+l(a.y-this.y)},offset:function(a,b){this.x+=a||0;this.y+=b||0;return this},magnitude:function(){return r(this.x*
this.x+this.y*this.y)||.01},update:function(a,b){this.x=a||0;this.y=b||0;return this},round:function(a){this.x=a?this.x.toFixed(a):v(this.x);this.y=a?this.y.toFixed(a):v(this.y);return this},normalize:function(a){a=(a||1)/this.magnitude();this.x*=a;this.y*=a;return this},difference:function(b){return a(this.x-b.x,this.y-b.y)},bearing:function(a){return b(this,a).bearing()},toPolar:function(b){b=b&&a(b)||a(0,0);var c=this.x,d=this.y;this.x=r((c-b.x)*(c-b.x)+(d-b.y)*(d-b.y));this.y=B(b.theta(a(c,d)));
return this},rotate:function(b,c){c=(c+360)%360;this.toPolar(b);this.y+=B(c);var d=a.fromPolar(this.x,this.y,b);this.x=d.x;this.y=d.y;return this},move:function(b,c){var d=B(a(b).theta(this));return this.offset(p(d)*c,-h(d)*c)},changeInAngle:function(b,c,d){return a(this).offset(-b,-c).theta(d)-this.theta(d)},equals:function(a){return this.x===a.x&&this.y===a.y},snapToGrid:function(a,b){this.x=F(this.x,a);this.y=F(this.y,b||a);return this}};a.fromPolar=function(b,c,d){d=d&&a(d)||a(0,0);var e=l(b*
p(c));b=l(b*h(c));c=E(z(c));90>c?b=-b:180>c?(e=-e,b=-b):270>c&&(e=-e);return a(d.x+e,d.y+b)};a.random=function(b,c,d,e){return a(y(A()*(c-b+1)+b),y(A()*(e-d+1)+d))};b.prototype={toString:function(){return this.start.toString()+" "+this.end.toString()},length:function(){return r(this.squaredLength())},squaredLength:function(){var a=this.start.x,b=this.start.y,c=this.end.y;return(a-=this.end.x)*a+(b-=c)*b},midpoint:function(){return a((this.start.x+this.end.x)/2,(this.start.y+this.end.y)/2)},intersection:function(b){var c=
a(this.end.x-this.start.x,this.end.y-this.start.y),d=a(b.end.x-b.start.x,b.end.y-b.start.y),e=c.x*d.y-c.y*d.x;b=a(b.start.x-this.start.x,b.start.y-this.start.y);d=b.x*d.y-b.y*d.x;b=b.x*c.y-b.y*c.x;if(0===e||0>d*e||0>b*e)return null;if(0<e){if(d>e||b>e)return null}else if(d<e||b<e)return null;return a(this.start.x+d*c.x/e,this.start.y+d*c.y/e)},bearing:function(){var a=B(this.start.y),b=B(this.end.y),c=B(this.end.x-this.start.x),d=h(c)*p(b),a=p(a)*h(b)-h(a)*p(b)*p(c),d=z(q(d,a))-22.5;0>d&&(d+=360);
d=parseInt(d/45);return"NE E SE S SW W NW N".split(" ")[d]}};c.prototype={toString:function(){return this.origin().toString()+" "+this.corner().toString()},origin:function(){return a(this.x,this.y)},corner:function(){return a(this.x+this.width,this.y+this.height)},topRight:function(){return a(this.x+this.width,this.y)},bottomLeft:function(){return a(this.x,this.y+this.height)},center:function(){return a(this.x+this.width/2,this.y+this.height/2)},intersect:function(a){var b=this.origin(),c=this.corner(),
d=a.origin();a=a.corner();return a.x<=b.x||a.y<=b.y||d.x>=c.x||d.y>=c.y?!1:!0},sideNearestToPoint:function(b){b=a(b);var c=this.x+this.width-b.x,d=b.y-this.y,e=this.y+this.height-b.y;b=b.x-this.x;var h="left";c<b&&(b=c,h="right");d<b&&(b=d,h="top");e<b&&(h="bottom");return h},containsPoint:function(b){b=a(b);return b.x>=this.x&&b.x<=this.x+this.width&&b.y>=this.y&&b.y<=this.y+this.height?!0:!1},containsRect:function(a){var b=c(a).normalize();a=b.width;var d=b.height,e=b.x,b=b.y,h=this.width,l=this.height;
if(0>(h|l|a|d))return!1;var p=this.x,n=this.y;if(e<p||b<n)return!1;h+=p;a+=e;if(a<=e){if(h>=p||a>h)return!1}else if(h>=p&&a>h)return!1;l+=n;d+=b;if(d<=b){if(l>=n||d>l)return!1}else if(l>=n&&d>l)return!1;return!0},pointNearestToPoint:function(b){b=a(b);if(this.containsPoint(b))switch(this.sideNearestToPoint(b)){case "right":return a(this.x+this.width,b.y);case "left":return a(this.x,b.y);case "bottom":return a(b.x,this.y+this.height);case "top":return a(b.x,this.y)}return b.adhereToRect(this)},intersectionWithLineFromCenterToPoint:function(c,
d){c=a(c);var e=a(this.x+this.width/2,this.y+this.height/2),h;d&&c.rotate(e,d);for(var l=[b(this.origin(),this.topRight()),b(this.topRight(),this.corner()),b(this.corner(),this.bottomLeft()),b(this.bottomLeft(),this.origin())],p=b(e,c),n=l.length-1;0<=n;--n){var r=l[n].intersection(p);if(null!==r){h=r;break}}h&&d&&h.rotate(e,-d);return h},moveAndExpand:function(a){this.x+=a.x;this.y+=a.y;this.width+=a.width;this.height+=a.height;return this},round:function(a){this.x=a?this.x.toFixed(a):v(this.x);
this.y=a?this.y.toFixed(a):v(this.y);this.width=a?this.width.toFixed(a):v(this.width);this.height=a?this.height.toFixed(a):v(this.height);return this},normalize:function(){var a=this.x,b=this.y,c=this.width,d=this.height;0>this.width&&(a=this.x+this.width,c=-this.width);0>this.height&&(b=this.y+this.height,d=-this.height);this.x=a;this.y=b;this.width=c;this.height=d;return this}};d.prototype={toString:function(){return a(this.x,this.y).toString()+" "+this.a+" "+this.b},bbox:function(){return c(this.x-
this.a,this.y-this.b,2*this.a,2*this.b)},intersectionWithLineFromCenterToPoint:function(b,c){b=a(b);c&&b.rotate(a(this.x,this.y),c);var d=b.x-this.x,e=b.y-this.y;if(0===d)return d=this.bbox().pointNearestToPoint(b),c?d.rotate(a(this.x,this.y),-c):d;var e=e/d,h=r(1/(1/(this.a*this.a)+e*e/(this.b*this.b))),h=0>d?-h:h,d=a(this.x+h,this.y+e*h);return c?d.rotate(a(this.x,this.y),-c):d}};return{toDeg:z,toRad:B,snapToGrid:F,normalizeAngle:E,point:a,line:b,rect:c,ellipse:d,bezier:{curveThroughPoints:function(a){for(var b=
this.getCurveControlPoints(a),c=["M",a[0].x,a[0].y],d=0;d<b[0].length;d++)c.push("C",b[0][d].x,b[0][d].y,b[1][d].x,b[1][d].y,a[d+1].x,a[d+1].y);return c},getCurveControlPoints:function(b){var c=[],d=[],e=b.length-1,h;if(1==e)return c[0]=a((2*b[0].x+b[1].x)/3,(2*b[0].y+b[1].y)/3),d[0]=a(2*c[0].x-b[0].x,2*c[0].y-b[0].y),[c,d];var l=[];for(h=1;h<e-1;h++)l[h]=4*b[h].x+2*b[h+1].x;l[0]=b[0].x+2*b[1].x;l[e-1]=(8*b[e-1].x+b[e].x)/2;var p=this.getFirstControlPoints(l);for(h=1;h<e-1;++h)l[h]=4*b[h].y+2*b[h+
1].y;l[0]=b[0].y+2*b[1].y;l[e-1]=(8*b[e-1].y+b[e].y)/2;l=this.getFirstControlPoints(l);for(h=0;h<e;h++)c.push(a(p[h],l[h])),h<e-1?d.push(a(2*b[h+1].x-p[h+1],2*b[h+1].y-l[h+1])):d.push(a((b[e].x+p[e-1])/2,(b[e].y+l[e-1])/2));return[c,d]},getFirstControlPoints:function(a){var b=a.length,c=[],d=[],e=2;c[0]=a[0]/e;for(var h=1;h<b;h++)d[h]=1/e,e=(h<b-1?4:3.5)-d[h],c[h]=(a[h]-c[h-1])/e;for(h=1;h<b;h++)c[b-h-1]-=d[b-h]*c[b-h];return c}},scale:{linear:function(a,b,c){return(c-a[0])/(a[1]-a[0])*(b[1]-b[0])+
b[0]||0}}}});if("object"===typeof exports)var _=require("lodash");
var joint={dia:{},ui:{},layout:{},shapes:{},format:{},connectors:{},routers:{},util:{hashCode:function(a){var b=0;if(0==a.length)return b;for(var c=0;c<a.length;c++)var d=a.charCodeAt(c),b=(b<<5)-b+d,b=b&b;return b},getByPath:function(a,b,c){for(b=b.split(c||".");b.length;)if(c=b.shift(),c in a)a=a[c];else return;return a},setByPath:function(a,b,c,d){d=d||".";var e=b.split(d),l=a,p=0;if(-1<b.indexOf(d)){for(b=e.length;p<b-1;p++)l=l[e[p]]||(l[e[p]]={});l[e[b-1]]=c}else a[b]=c;return a},unsetByPath:function(a,
b,c){c=c||".";var d=b.lastIndexOf(c);-1<d?(c=joint.util.getByPath(a,b.substr(0,d),c))&&delete c[b.slice(d+1)]:delete a[b];return a},flattenObject:function(a,b,c){b=b||".";var d={},e;for(e in a)if(a.hasOwnProperty(e)){var l="object"===typeof a[e];l&&c&&c(a[e])&&(l=!1);if(l){var l=this.flattenObject(a[e],b,c),p;for(p in l)l.hasOwnProperty(p)&&(d[e+b+p]=l[p])}else d[e]=a[e]}return d},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==
a?b:b&3|8).toString(16)})},guid:function(a){this.guid.id=this.guid.id||1;a.id=void 0===a.id?"j_"+this.guid.id++:a.id;return a.id},mixin:function(){for(var a=arguments[0],b=1,c=arguments.length;b<c;b++){var d=arguments[b];(Object(d)===d||_.isFunction(d)||null!==d&&void 0!==d)&&_.each(d,function(b,c){this.mixin.deep&&Object(b)===b?(a[c]||(a[c]=_.isArray(b)?[]:{}),this.mixin(a[c],b)):a[c]!==b&&(this.mixin.supplement&&a.hasOwnProperty(c)||(a[c]=b))},this)}return a},supplement:function(){this.mixin.supplement=
!0;var a=this.mixin.apply(this,arguments);this.mixin.supplement=!1;return a},deepMixin:function(){this.mixin.deep=!0;var a=this.mixin.apply(this,arguments);this.mixin.deep=!1;return a},deepSupplement:function(){this.mixin.deep=this.mixin.supplement=!0;var a=this.mixin.apply(this,arguments);this.mixin.deep=this.mixin.supplement=!1;return a},normalizeEvent:function(a){return a.originalEvent&&a.originalEvent.changedTouches&&a.originalEvent.changedTouches.length?a.originalEvent.changedTouches[0]:a},nextFrame:function(){var a,
b="undefined"!=typeof window;b&&(a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame);if(!a){var c=0;a=function(a){var b=(new Date).getTime(),l=Math.max(0,16-(b-c)),p=setTimeout(function(){a(b+l)},l);c=b+l;return p}}return b?_.bind(a,window):a}(),cancelFrame:function(){var a,b="undefined"!=typeof window;b&&(a=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||
window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.oCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame);a=a||clearTimeout;return b?_.bind(a,window):a}(),breakText:function(a,b,c,d){d=d||{};var e=b.width;b=b.height;var l=d.svgDocument||V("svg").node;c=V("<text><tspan></tspan></text>").attr(c||{}).node;var p=c.firstChild,h=document.createTextNode("");p.appendChild(h);l.appendChild(c);d.svgDocument||
document.body.appendChild(l);a=a.split(" ");for(var r=[],n=[],u,q=0,v=0,y=a.length;q<y;q++){var x=a[q];h.data=n[v]?n[v]+" "+x:x;if(p.getComputedTextLength()<=e)n[v]=h.data,u&&(r[v++]=!0,u=0);else{if(!n[v]||u){var A=!!u;u=x.length-1;if(A||!u){if(!u){if(!n[v]){n=[];break}a.splice(q,2,x+a[q+1]);y--;r[v++]=!0;q--;continue}a[q]=x.substring(0,u);a[q+1]=x.substring(u)+a[q+1]}else a.splice(q,1,x.substring(0,u),x.substring(u)),y++,v&&!r[v-1]&&v--;q--;continue}v++;q--}if("undefined"!==typeof b){var z=z||1.25*
c.getBBox().height;if(z*n.length>b){n.splice(Math.floor(b/z));break}}}d.svgDocument?l.removeChild(c):document.body.removeChild(l);return n.join("\n")},timing:{linear:function(a){return a},quad:function(a){return a*a},cubic:function(a){return a*a*a},inout:function(a){if(0>=a)return 0;if(1<=a)return 1;var b=a*a,c=b*a;return 4*(.5>a?c:3*(a-b)+c-.75)},exponential:function(a){return Math.pow(2,10*(a-1))},bounce:function(a){for(var b=0,c=1;;b+=c,c/=2)if(a>=(7-4*b)/11)return a=(11-6*b-11*a)/4,-a*a+c*c},
reverse:function(a){return function(b){return 1-a(1-b)}},reflect:function(a){return function(b){return.5*(.5>b?a(2*b):2-a(2-2*b))}},clamp:function(a,b,c){b=b||0;c=c||1;return function(d){d=a(d);return d<b?b:d>c?c:d}},back:function(a){a||(a=1.70158);return function(b){return b*b*((a+1)*b-a)}},elastic:function(a){a||(a=1.5);return function(b){return Math.pow(2,10*(b-1))*Math.cos(20*Math.PI*a/3*b)}}},interpolate:{number:function(a,b){var c=b-a;return function(b){return a+c*b}},object:function(a,b){var c=
_.keys(a);return function(d){var e,l,p={};for(e=c.length-1;-1!=e;e--)l=c[e],p[l]=a[l]+(b[l]-a[l])*d;return p}},hexColor:function(a,b){var c=parseInt(a.slice(1),16),d=parseInt(b.slice(1),16),e=c&255,l=(d&255)-e,p=c&65280,h=(d&65280)-p,r=c&16711680,n=(d&16711680)-r;return function(a){return"#"+(16777216|e+l*a&255|p+h*a&65280|r+n*a&16711680).toString(16).slice(1)}},unit:function(a,b){var c=/(-?[0-9]*.[0-9]*)(px|em|cm|mm|in|pt|pc|%)/,d=c.exec(a),c=c.exec(b),e=c[1].indexOf("."),l=0<e?c[1].length-e-1:0;
a=+d[1];var p=+c[1]-a,h=d[2];return function(b){return(a+p*b).toFixed(l)+h}}},filter:{blur:function(a){var b=_.isFinite(a.x)?a.x:2;return _.template('<filter><feGaussianBlur stdDeviation="${stdDeviation}"/></filter>',{stdDeviation:_.isFinite(a.y)?[b,a.y]:b})},dropShadow:function(a){return _.template("SVGFEDropShadowElement"in window?'<filter><feDropShadow stdDeviation="${blur}" dx="${dx}" dy="${dy}" flood-color="${color}" flood-opacity="${opacity}"/></filter>':'<filter><feGaussianBlur in="SourceAlpha" stdDeviation="${blur}"/><feOffset dx="${dx}" dy="${dy}" result="offsetblur"/><feFlood flood-color="${color}"/><feComposite in2="offsetblur" operator="in"/><feComponentTransfer><feFuncA type="linear" slope="${opacity}"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>',
{dx:a.dx||0,dy:a.dy||0,opacity:_.isFinite(a.opacity)?a.opacity:1,color:a.color||"black",blur:_.isFinite(a.blur)?a.blur:4})},grayscale:function(a){a=_.isFinite(a.amount)?a.amount:1;return _.template('<filter><feColorMatrix type="matrix" values="${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${b} ${h} 0 0 0 0 0 1 0"/></filter>',{a:.2126+.7874*(1-a),b:.7152-.7152*(1-a),c:.0722-.0722*(1-a),d:.2126-.2126*(1-a),e:.7152+.2848*(1-a),f:.0722-.0722*(1-a),g:.2126-.2126*(1-a),h:.0722+.9278*(1-a)})},sepia:function(a){a=
_.isFinite(a.amount)?a.amount:1;return _.template('<filter><feColorMatrix type="matrix" values="${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${h} ${i} 0 0 0 0 0 1 0"/></filter>',{a:.393+.607*(1-a),b:.769-.769*(1-a),c:.189-.189*(1-a),d:.349-.349*(1-a),e:.686+.314*(1-a),f:.168-.168*(1-a),g:.272-.272*(1-a),h:.534-.534*(1-a),i:.131+.869*(1-a)})},saturate:function(a){a=_.isFinite(a.amount)?a.amount:1;return _.template('<filter><feColorMatrix type="saturate" values="${amount}"/></filter>',{amount:1-a})},
hueRotate:function(a){return _.template('<filter><feColorMatrix type="hueRotate" values="${angle}"/></filter>',{angle:a.angle||0})},invert:function(a){a=_.isFinite(a.amount)?a.amount:1;return _.template('<filter><feComponentTransfer><feFuncR type="table" tableValues="${amount} ${amount2}"/><feFuncG type="table" tableValues="${amount} ${amount2}"/><feFuncB type="table" tableValues="${amount} ${amount2}"/></feComponentTransfer></filter>',{amount:a,amount2:1-a})},brightness:function(a){return _.template('<filter><feComponentTransfer><feFuncR type="linear" slope="${amount}"/><feFuncG type="linear" slope="${amount}"/><feFuncB type="linear" slope="${amount}"/></feComponentTransfer></filter>',
{amount:_.isFinite(a.amount)?a.amount:1})},contrast:function(a){a=_.isFinite(a.amount)?a.amount:1;return _.template('<filter><feComponentTransfer><feFuncR type="linear" slope="${amount}" intercept="${amount2}"/><feFuncG type="linear" slope="${amount}" intercept="${amount2}"/><feFuncB type="linear" slope="${amount}" intercept="${amount2}"/></feComponentTransfer></filter>',{amount:a,amount2:.5-a/2})}},format:{number:function(a,b,c){function d(a){for(var b=a.length,d=[],e=0,h=c.grouping[0];0<b&&0<h;)d.push(a.substring(b-=
h,b+h)),h=c.grouping[e=(e+1)%c.grouping.length];return d.reverse().join(c.thousands)}c=c||{currency:["$",""],decimal:".",thousands:",",grouping:[3]};var e=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i.exec(a),l=e[1]||" ";a=e[2]||">";var p=e[3]||"",h=e[4]||"",r=e[5],n=+e[6],u=e[7],q=e[8],v=e[9],y=1,x=e="",A=!1;q&&(q=+q.substring(1));if(r||"0"===l&&"="===a)r=l="0",a="=",u&&(n-=Math.floor((n-1)/4));switch(v){case "n":u=!0;v="g";break;case "%":y=100;x="%";v="f";break;case "p":y=
100;x="%";v="r";break;case "b":case "o":case "x":case "X":"#"===h&&(e="0"+v.toLowerCase());case "c":case "d":A=!0;q=0;break;case "s":y=-1,v="r"}"$"===h&&(e=c.currency[0],x=c.currency[1]);"r"!=v||q||(v="g");if(null!=q)if("g"==v)q=Math.max(1,Math.min(21,q));else if("e"==v||"f"==v)q=Math.max(0,Math.min(20,q));h=r&&u;if(A&&b%1)return"";p=0>b||0===b&&0>1/b?(b=-b,"-"):p;A=x;0>y?(A=this.prefix(b,q),b=A.scale(b),A=A.symbol+x):b*=y;b=this.convert(v,b,q);v=b.lastIndexOf(".");q=0>v?b:b.substring(0,v);b=0>v?
"":c.decimal+b.substring(v+1);!r&&u&&c.grouping&&(q=d(q));r=e.length+q.length+b.length+(h?0:p.length);l=r<n?Array(r=n-r+1).join(l):"";h&&(q=d(l+q));p+=e;b=q+b;return("<"===a?p+b+l:">"===a?l+p+b:"^"===a?l.substring(0,r>>=1)+p+b+l.substring(r):p+(h?b:l+b))+A},convert:function(a,b,c){switch(a){case "b":return b.toString(2);case "c":return String.fromCharCode(b);case "o":return b.toString(8);case "x":return b.toString(16);case "X":return b.toString(16).toUpperCase();case "g":return b.toPrecision(c);case "e":return b.toExponential(c);
case "f":return b.toFixed(c);case "r":return(b=this.round(b,this.precision(b,c))).toFixed(Math.max(0,Math.min(20,this.precision(b*(1+1E-15),c))));default:return b+""}},round:function(a,b){return b?Math.round(a*(b=Math.pow(10,b)))/b:Math.round(a)},precision:function(a,b){return b-(a?Math.ceil(Math.log(a)/Math.LN10):1)},prefix:function(a,b){var c=_.map("y z a f p n \u00b5 m  k M G T P E Z Y".split(" "),function(a,b){var c=Math.pow(10,3*abs(8-b));return{scale:8<b?function(a){return a/c}:function(a){return a*
c},symbol:a}}),d=0;a&&(0>a&&(a*=-1),b&&(a=d3.round(a,this.precision(a,b))),d=1+Math.floor(1E-12+Math.log(a)/Math.LN10),d=Math.max(-24,Math.min(24,3*Math.floor((0>=d?d+1:d-1)/3))));return c[8+d/3]}}}};"object"===typeof exports&&(module.exports=joint);if("object"===typeof exports)var joint={dia:{Link:require("./joint.dia.link").Link,Element:require("./joint.dia.element").Element},shapes:require("../plugins/shapes")},Backbone=require("backbone"),_=require("lodash"),g=require("./geometry");
joint.dia.GraphCells=Backbone.Collection.extend({initialize:function(){this.on("change:z",this.sort,this)},model:function(a,b){if("link"===a.type)return new joint.dia.Link(a,b);var c=a.type.split(".")[0],d=a.type.split(".")[1];return joint.shapes[c]&&joint.shapes[c][d]?new joint.shapes[c][d](a,b):new joint.dia.Element(a,b)},comparator:function(a){return a.get("z")||0},getConnectedLinks:function(a,b){b=b||{};_.isUndefined(b.inbound)&&_.isUndefined(b.outbound)&&(b.inbound=b.outbound=!0);var c=[];this.each(function(d){var e=
d.get("source"),l=d.get("target");e&&e.id===a.id&&b.outbound&&c.push(d);l&&l.id===a.id&&b.inbound&&c.push(d)});return c}});
joint.dia.Graph=Backbone.Model.extend({initialize:function(){this.set("cells",new joint.dia.GraphCells);this.get("cells").on("all",this.trigger,this);this.get("cells").on("remove",this.removeCell,this)},toJSON:function(){var a=Backbone.Model.prototype.toJSON.apply(this,arguments),b=this.get("cells"),c=[];_.each(b.models,function(a){c.push(a.get("attrs"))});a.cells=this.get("cells").toJSON();_.each(a.cells,function(a,b){a.attrs=c[b]});return a},fromJSON:function(a){if(!a.cells)throw Error("Graph JSON must contain cells array.");
var b=a.cells;delete a.cells;this.set(a);this.resetCells(b)},clear:function(){this.trigger("batch:start");this.get("cells").remove(this.get("cells").models);this.trigger("batch:stop")},_prepareCell:function(a){a instanceof Backbone.Model&&_.isUndefined(a.get("z"))?a.set("z",this.maxZIndex()+1,{silent:!0}):_.isUndefined(a.z)&&(a.z=this.maxZIndex()+1);return a},maxZIndex:function(){var a=this.get("cells").last();return a?a.get("z")||0:0},addCell:function(a,b){if(_.isArray(a))return this.addCells(a,
b);this.get("cells").add(this._prepareCell(a),b||{});return this},addCells:function(a,b){_.each(a,function(a){this.addCell(a,b)},this);return this},resetCells:function(a){this.get("cells").reset(_.map(a,this._prepareCell,this));return this},removeCell:function(a,b,c){c&&c.disconnectLinks?this.disconnectLinks(a):this.removeLinks(a);this.get("cells").remove(a,{silent:!0})},getCell:function(a){return this.get("cells").get(a)},getElements:function(){return this.get("cells").filter(function(a){return a instanceof
joint.dia.Element})},getLinks:function(){return this.get("cells").filter(function(a){return a instanceof joint.dia.Link})},getConnectedLinks:function(a,b){return this.get("cells").getConnectedLinks(a,b)},getNeighbors:function(a){var b=this.getConnectedLinks(a),c=[],d=this.get("cells");_.each(b,function(b){var l=b.get("source");b=b.get("target");l.x||(l=d.get(l.id),l!==a&&c.push(l));b.x||(l=d.get(b.id),l!==a&&c.push(l))});return c},disconnectLinks:function(a){_.each(this.getConnectedLinks(a),function(b){b.set(b.get("source").id===
a.id?"source":"target",g.point(0,0))})},removeLinks:function(a){_.invoke(this.getConnectedLinks(a),"remove")},findModelsFromPoint:function(a){return _.filter(this.getElements(),function(b){return b.getBBox().containsPoint(a)})},findModelsInArea:function(a){return _.filter(this.getElements(),function(b){return b.getBBox().intersect(a)})}});"object"===typeof exports&&(module.exports.Graph=joint.dia.Graph);
"object"===typeof exports&&(joint={util:require("./core").util,dia:{Link:require("./joint.dia.link").Link}},Backbone=require("backbone"),_=require("lodash"));
joint.dia.Cell=Backbone.Model.extend({constructor:function(a,b){var c,d=a||{};this.cid=_.uniqueId("c");this.attributes={};b&&b.collection&&(this.collection=b.collection);b&&b.parse&&(d=this.parse(d,b)||{});if(c=_.result(this,"defaults"))d=_.merge({},c,d);this.set(d,b);this.changed={};this.initialize.apply(this,arguments)},toJSON:function(){var a=this.constructor.prototype.defaults.attrs||{},b={};_.each(this.attributes.attrs,function(c,e){var l=a[e];_.each(c,function(a,c){_.isObject(a)&&!_.isArray(a)?
_.each(a,function(a,d){l&&l[c]&&_.isEqual(l[c][d],a)||(b[e]=b[e]||{},(b[e][c]||(b[e][c]={}))[d]=a)}):l&&_.isEqual(l[c],a)||(b[e]=b[e]||{},b[e][c]=a)})});var c=_.cloneDeep(_.omit(this.attributes,"attrs"));c.attrs=b;return c},initialize:function(a){a&&a.id||this.set("id",joint.util.uuid(),{silent:!0});this._transitionIds={};this.processPorts();this.on("change:attrs",this.processPorts,this)},processPorts:function(){var a=this.ports,b={};_.each(this.get("attrs"),function(a,c){a&&a.port&&(_.isUndefined(a.port.id)?
b[a.port]={id:a.port}:b[a.port.id]=a.port)});var c={};_.each(a,function(a,e){b[e]||(c[e]=!0)});this.collection&&!_.isEmpty(c)&&(a=this.collection.getConnectedLinks(this,{inbound:!0}),_.each(a,function(a){c[a.get("target").port]&&a.remove()}),a=this.collection.getConnectedLinks(this,{outbound:!0}),_.each(a,function(a){c[a.get("source").port]&&a.remove()}));this.ports=b},remove:function(a){var b=this.collection;b&&b.trigger("batch:start");var c=this.get("parent");c&&(this.collection&&this.collection.get(c)).unembed(this);
_.invoke(this.getEmbeddedCells(),"remove",a);this.trigger("remove",this,this.collection,a);b&&b.trigger("batch:stop")},toFront:function(){this.collection&&this.set("z",(this.collection.last().get("z")||0)+1)},toBack:function(){this.collection&&this.set("z",(this.collection.first().get("z")||0)-1)},embed:function(a){if(this.get("parent")==a.id)throw Error("Recursive embedding not allowed.");this.trigger("batch:start");a.set("parent",this.id);this.set("embeds",_.uniq((this.get("embeds")||[]).concat([a.id])));
this.trigger("batch:stop")},unembed:function(a){this.trigger("batch:start");var b=a.id;a.unset("parent");this.set("embeds",_.without(this.get("embeds"),b));this.trigger("batch:stop")},getEmbeddedCells:function(){return this.collection?_.map(this.get("embeds")||[],function(a){return this.collection.get(a)},this):[]},clone:function(a){a=a||{};var b=Backbone.Model.prototype.clone.apply(this,arguments);b.set("id",joint.util.uuid(),{silent:!0});b.set("embeds","");if(!a.deep)return b;var c=this.getEmbeddedCells(),
d=[b],e={};_.each(c,function(a){var c=a.clone({deep:!0});b.embed(c[0]);_.each(c,function(b){d.push(b);if(!(b instanceof joint.dia.Link)){var c=this.collection.getConnectedLinks(a,{inbound:!0});_.each(c,function(a){var c=e[a.id]||a.clone();e[a.id]=c;a=_.clone(c.get("target"));a.id=b.id;c.set("target",a)});c=this.collection.getConnectedLinks(a,{outbound:!0});_.each(c,function(a){var c=e[a.id]||a.clone();e[a.id]=c;a=_.clone(c.get("source"));a.id=b.id;c.set("source",a)})}},this)},this);return d=d.concat(_.values(e))},
attr:function(a,b,c){var d=this.get("attrs");if(_.isString(a)){if("undefined"!=typeof b){var e={};joint.util.setByPath(e,a,b,"/");return this.set("attrs",_.merge({},d,e),c)}return joint.util.getByPath(d,a,"/")}return this.set("attrs",_.merge({},d,a),b,c)},removeAttr:function(a,b){if(_.isArray(a))return _.each(a,function(a){this.removeAttr(a,b)},this),this;var c=joint.util.unsetByPath(_.merge({},this.get("attrs")),a,"/");return this.set("attrs",c,_.extend({dirty:!0},b))},transition:function(a,b,c,
d){d=d||"/";c=_.extend({duration:100,delay:10,timingFunction:joint.util.timing.linear,valueFunction:joint.util.interpolate.number},c);var e=a.split(d),l=e[0],p=1<e.length,h=0,r,n=_.bind(function(b){var e;h=h||b;b-=h;b/=c.duration;1>b?this._transitionIds[a]=e=joint.util.nextFrame(n):(b=1,delete this._transitionIds[a]);b=r(c.timingFunction(b));p&&(b=joint.util.setByPath({},a,b,d)[l],b=_.merge({},this.get(l),b));c.transitionId=e;this.set(l,b,c);e||this.trigger("transition:end",this,a)},this),e=_.bind(function(e){this.stopTransitions(a);
r=c.valueFunction(joint.util.getByPath(this.attributes,a,d),b);this._transitionIds[a]=joint.util.nextFrame(e);this.trigger("transition:start",this,a)},this);return _.delay(e,c.delay,n)},getTransitions:function(){return _.keys(this._transitionIds)},stopTransitions:function(a,b){b=b||"/";var c=a&&a.split(b);_(this._transitionIds).keys().filter(c&&function(a){return _.isEqual(c,a.split(b).slice(0,c.length))}).each(function(a){joint.util.cancelFrame(this._transitionIds[a]);delete this._transitionIds[a];
this.trigger("transition:end",this,a)},this)}});
joint.dia.CellView=Backbone.View.extend({tagName:"g",attributes:function(){return{"model-id":this.model.id}},initialize:function(){_.bindAll(this,"remove","update");this.$el.data("view",this);this.listenTo(this.model,"remove",this.remove);this.listenTo(this.model,"change:attrs",this.onChangeAttrs)},onChangeAttrs:function(a,b,c){return c.dirty?this.render():this.update()},_configure:function(a){a.id=a.id||joint.util.guid(this);Backbone.View.prototype._configure.apply(this,arguments)},_ensureElement:function(){var a;
this.el?a=_.result(this,"el"):(a=_.extend({id:this.id},_.result(this,"attributes")),this.className&&(a["class"]=_.result(this,"className")),a=V(_.result(this,"tagName"),a).node);this.setElement(a,!1)},findBySelector:function(a){return"."===a?this.$el:this.$el.find(a)},notify:function(a){if(this.paper){var b=Array.prototype.slice.call(arguments,1);this.trigger.apply(this,[a].concat(b));this.paper.trigger.apply(this.paper,[a,this].concat(b))}},getStrokeBBox:function(a){var b=!!a;a=a||this.el;var c=
V(a).bbox(!1,this.paper.viewport);a=b?V(a).attr("stroke-width"):this.model.attr("rect/stroke-width")||this.model.attr("circle/stroke-width")||this.model.attr("ellipse/stroke-width")||this.model.attr("path/stroke-width");a=parseFloat(a)||0;return g.rect(c).moveAndExpand({x:-a/2,y:-a/2,width:a,height:a})},getBBox:function(){return V(this.el).bbox()},highlight:function(a){a=a?this.$(a)[0]||this.el:this.el;V(a).addClass("highlighted")},unhighlight:function(a){a=a?this.$(a)[0]||this.el:this.el;V(a).removeClass("highlighted")},
findMagnet:function(a){a=this.$(a);return 0===a.length||a[0]===this.el?(a=this.model.get("attrs")||{},a["."]&&!1===a["."].magnet?void 0:this.el):a.attr("magnet")?a[0]:this.findMagnet(a.parent())},applyFilter:function(a,b){var c=this.findBySelector(a),d=b.name+this.paper.svg.id+joint.util.hashCode(JSON.stringify(b));if(!this.paper.svg.getElementById(d)){var e=joint.util.filter[b.name]&&joint.util.filter[b.name](b.args||{});if(!e)throw Error("Non-existing filter "+b.name);e=V(e);e.attr("filterUnits",
"userSpaceOnUse");b.attrs&&e.attr(b.attrs);e.node.id=d;V(this.paper.svg).defs().append(e)}c.each(function(){V(this).attr("filter","url(#"+d+")")})},applyGradient:function(a,b,c){a=this.findBySelector(a);var d=c.type+this.paper.svg.id+joint.util.hashCode(JSON.stringify(c));if(!this.paper.svg.getElementById(d)){var e=["<"+c.type+">",_.map(c.stops,function(a){return'<stop offset="'+a.offset+'" stop-color="'+a.color+'" stop-opacity="'+(_.isFinite(a.opacity)?a.opacity:1)+'" />'}).join(""),"</"+c.type+
">"].join(""),e=V(e);c.attrs&&e.attr(c.attrs);e.node.id=d;V(this.paper.svg).defs().append(e)}a.each(function(){V(this).attr(b,"url(#"+d+")")})},getSelector:function(a,b){if(a===this.el)return b;var c=$(a).index();b=a.tagName+":nth-child("+(c+1)+") "+(b||"");return this.getSelector($(a).parent()[0],b+" ")},pointerdblclick:function(a,b,c){this.notify("cell:pointerdblclick",a,b,c)},pointerclick:function(a,b,c){this.notify("cell:pointerclick",a,b,c)},pointerdown:function(a,b,c){this.model.collection&&
(this.model.trigger("batch:start"),this._collection=this.model.collection);this.notify("cell:pointerdown",a,b,c)},pointermove:function(a,b,c){this.notify("cell:pointermove",a,b,c)},pointerup:function(a,b,c){this.notify("cell:pointerup",a,b,c);this._collection&&(this._collection.trigger("batch:stop"),delete this._collection)}});"object"===typeof exports&&(module.exports.Cell=joint.dia.Cell,module.exports.CellView=joint.dia.CellView);
"object"===typeof exports&&(joint={util:require("./core").util,dia:{Cell:require("./joint.dia.cell").Cell,CellView:require("./joint.dia.cell").CellView}},Backbone=require("backbone"),_=require("lodash"));
joint.dia.Element=joint.dia.Cell.extend({defaults:{position:{x:0,y:0},size:{width:1,height:1},angle:0},position:function(a,b){this.set("position",{x:a,y:b})},translate:function(a,b,c){b=b||0;if(0===a&&0===b)return this;var d=this.get("position")||{x:0,y:0},d={x:d.x+a||0,y:d.y+b||0};c&&c.transition?(_.isObject(c.transition)||(c.transition={}),this.transition("position",d,_.extend({},c.transition,{valueFunction:joint.util.interpolate.object}))):(this.set("position",d,c),_.invoke(this.getEmbeddedCells(),
"translate",a,b,c));return this},resize:function(a,b){this.trigger("batch:start");this.set("size",{width:a,height:b});this.trigger("batch:stop");return this},rotate:function(a,b){return this.set("angle",b?a:((this.get("angle")||0)+a)%360)},getBBox:function(){var a=this.get("position"),b=this.get("size");return g.rect(a.x,a.y,b.width,b.height)}});
joint.dia.ElementView=joint.dia.CellView.extend({className:function(){return"element "+this.model.get("type").split(".").join(" ")},initialize:function(){_.bindAll(this,"translate","resize","rotate");joint.dia.CellView.prototype.initialize.apply(this,arguments);this.listenTo(this.model,"change:position",this.translate);this.listenTo(this.model,"change:size",this.resize);this.listenTo(this.model,"change:angle",this.rotate)},update:function(a,b){var c=this.model.get("attrs"),d=V(this.$(".rotatable")[0]);
if(d){var e=d.attr("transform");d.attr("transform","")}var l=[];_.each(b||c,function(a,b){var c=this.findBySelector(b);if(0!==c.length){var d="style text html ref-x ref-y ref-dx ref-dy ref-width ref-height ref x-alignment y-alignment port".split(" ");_.isObject(a.filter)&&(d.push("filter"),this.applyFilter(b,a.filter));_.isObject(a.fill)&&(d.push("fill"),this.applyGradient(b,"fill",a.fill));_.isObject(a.stroke)&&(d.push("stroke"),this.applyGradient(b,"stroke",a.stroke));_.isUndefined(a.text)||c.each(function(){V(this).text(a.text+
"")});var e=_.omit(a,d);c.each(function(){V(this).attr(e)});a.port&&c.attr("port",_.isUndefined(a.port.id)?a.port:a.port.id);a.style&&c.css(a.style);_.isUndefined(a.html)||c.each(function(){$(this).html(a.html+"")});_.isUndefined(a["ref-x"])&&_.isUndefined(a["ref-y"])&&_.isUndefined(a["ref-dx"])&&_.isUndefined(a["ref-dy"])&&_.isUndefined(a["x-alignment"])&&_.isUndefined(a["y-alignment"])&&_.isUndefined(a["ref-width"])&&_.isUndefined(a["ref-height"])||_.each(c,function(a,b,c){a=$(a);a.selector=c.selector;
l.push(a)})}},this);var p=this.el.getBBox();b=b||{};_.each(l,function(a){var d=b[a.selector],d=d?_.merge({},c[a.selector],d):c[a.selector];this.positionRelative(a,p,d)},this);d&&d.attr("transform",e||"")},positionRelative:function(a,b,c){function d(a){return _.isNumber(a)&&!_.isNaN(a)}var e=c.ref,l=parseFloat(c["ref-x"]),p=parseFloat(c["ref-y"]),h=parseFloat(c["ref-dx"]),r=parseFloat(c["ref-dy"]),n=c["y-alignment"],u=c["x-alignment"],q=parseFloat(c["ref-width"]),v=parseFloat(c["ref-height"]);c=_.contains(_.pluck(_.pluck(a.parents("g"),
"className"),"baseVal"),"scalable");e&&(b=V(this.findBySelector(e)[0]).bbox(!1,this.el));a=V(a[0]);a.attr("transform")&&a.attr("transform",a.attr("transform").replace(/translate\([^)]*\)/g,"")||"");var y=e=0;d(q)&&(0<=q&&1>=q?a.attr("width",q*b.width):a.attr("width",Math.max(q+b.width,0)));d(v)&&(0<=v&&1>=v?a.attr("height",v*b.height):a.attr("height",Math.max(v+b.height,0)));d(h)&&(c?(q=V(this.$(".scalable")[0]).scale(),e=b.x+b.width+h/q.sx):e=b.x+b.width+h);d(r)&&(c?(q=V(this.$(".scalable")[0]).scale(),
y=b.y+b.height+r/q.sy):y=b.y+b.height+r);d(l)&&(0<l&&1>l?e=b.x+b.width*l:c?(q=V(this.$(".scalable")[0]).scale(),e=b.x+l/q.sx):e=b.x+l);d(p)&&(0<p&&1>p?y=b.y+b.height*p:c?(q=V(this.$(".scalable")[0]).scale(),y=b.y+p/q.sy):y=b.y+p);b=a.bbox(!1,this.paper.viewport);"middle"===n?y-=b.height/2:d(n)&&(y+=-1<n&&1>n?b.height*n:n);"middle"===u?e-=b.width/2:d(u)&&(e+=-1<u&&1>u?b.width*u:u);a.translate(e,y)},renderMarkup:function(){var a=this.model.markup||this.model.get("markup");if(a)a=V(a),V(this.el).append(a);
else throw Error("properties.markup is missing while the default render() implementation is used.");},render:function(){this.$el.empty();this.renderMarkup();this.update();this.resize();this.rotate();this.translate();return this},scale:function(a,b){V(this.el).scale(a,b)},resize:function(){var a=this.model.get("size")||{width:1,height:1},b=this.model.get("angle")||0,c=V(this.$(".scalable")[0]);if(c){var d=c.bbox(!0);c.attr("transform","scale("+a.width/d.width+","+a.height/d.height+")");var e=(d=V(this.$(".rotatable")[0]))&&
d.attr("transform");e&&"null"!==e&&(d.attr("transform",e+" rotate("+-b+","+a.width/2+","+a.height/2+")"),a=c.bbox(!1,this.paper.viewport),this.model.set("position",{x:a.x,y:a.y}),this.rotate());this.update()}},translate:function(a,b,c){a=this.model.get("position")||{x:0,y:0};V(this.el).attr("transform","translate("+a.x+","+a.y+")")},rotate:function(){var a=V(this.$(".rotatable")[0]);if(a){var b=this.model.get("angle")||0,c=this.model.get("size")||{width:1,height:1};a.attr("transform","rotate("+b+
","+c.width/2+","+c.height/2+")")}},pointerdown:function(a,b,c){if(a.target.getAttribute("magnet")&&this.paper.options.validateMagnet.call(this.paper,this,a.target)){this.model.trigger("batch:start");var d=this.paper.getDefaultLink(this,a.target);d.set({source:{id:this.model.id,selector:this.getSelector(a.target),port:$(a.target).attr("port")},target:{x:b,y:c}});this.paper.model.addCell(d);this._linkView=this.paper.findViewByModel(d);this._linkView.startArrowheadMove("target")}else this._dx=b,this._dy=
c,joint.dia.CellView.prototype.pointerdown.apply(this,arguments)},pointermove:function(a,b,c){if(this._linkView)this._linkView.pointermove(a,b,c);else{var d=this.paper.options.gridSize;if(!1!==this.options.interactive){var e=this.model.get("position");this.model.translate(g.snapToGrid(e.x,d)-e.x+g.snapToGrid(b-this._dx,d),g.snapToGrid(e.y,d)-e.y+g.snapToGrid(c-this._dy,d))}this._dx=g.snapToGrid(b,d);this._dy=g.snapToGrid(c,d);joint.dia.CellView.prototype.pointermove.apply(this,arguments)}},pointerup:function(a,
b,c){this._linkView?(this._linkView.pointerup(a,b,c),delete this._linkView,this.model.trigger("batch:stop")):joint.dia.CellView.prototype.pointerup.apply(this,arguments)}});"object"===typeof exports&&(module.exports.Element=joint.dia.Element,module.exports.ElementView=joint.dia.ElementView);"object"===typeof exports&&(joint={dia:{Cell:require("./joint.dia.cell").Cell,CellView:require("./joint.dia.cell").CellView}},Backbone=require("backbone"),_=require("lodash"),g=require("./geometry"));
joint.dia.Link=joint.dia.Cell.extend({markup:'<path class="connection" stroke="black" fill="none"/><path class="marker-source" fill="black" stroke="black" /><path class="marker-target" fill="black" stroke="black" /><path class="connection-wrap" fill="none"/><g class="labels"/><g class="marker-vertices"/><g class="marker-arrowheads"/><g class="link-tools"/>',labelMarkup:'<g class="label"><rect /><image class="valve" xlink:href="/blueloop-backend/static/images/canvas/valve2.png"  height="25" width="25" x="-10" y="-10"/><text /></g>',
toolMarkup:'<g class="link-tool"><g class="tool-remove" event="remove"><circle r="11" /><path transform="scale(.8) translate(-16, -16)" d="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z"/><title></title></g><g class="tool-options" event="link:options"><circle r="11" transform="translate(25)"/><path fill="white" transform="scale(.55) translate(29, -16)" d="M31.229,17.736c0.064-0.571,0.104-1.148,0.104-1.736s-0.04-1.166-0.104-1.737l-4.377-1.557c-0.218-0.716-0.504-1.401-0.851-2.05l1.993-4.192c-0.725-0.91-1.549-1.734-2.458-2.459l-4.193,1.994c-0.647-0.347-1.334-0.632-2.049-0.849l-1.558-4.378C17.165,0.708,16.588,0.667,16,0.667s-1.166,0.041-1.737,0.105L12.707,5.15c-0.716,0.217-1.401,0.502-2.05,0.849L6.464,4.005C5.554,4.73,4.73,5.554,4.005,6.464l1.994,4.192c-0.347,0.648-0.632,1.334-0.849,2.05l-4.378,1.557C0.708,14.834,0.667,15.412,0.667,16s0.041,1.165,0.105,1.736l4.378,1.558c0.217,0.715,0.502,1.401,0.849,2.049l-1.994,4.193c0.725,0.909,1.549,1.733,2.459,2.458l4.192-1.993c0.648,0.347,1.334,0.633,2.05,0.851l1.557,4.377c0.571,0.064,1.148,0.104,1.737,0.104c0.588,0,1.165-0.04,1.736-0.104l1.558-4.377c0.715-0.218,1.399-0.504,2.049-0.851l4.193,1.993c0.909-0.725,1.733-1.549,2.458-2.458l-1.993-4.193c0.347-0.647,0.633-1.334,0.851-2.049L31.229,17.736zM16,20.871c-2.69,0-4.872-2.182-4.872-4.871c0-2.69,2.182-4.872,4.872-4.872c2.689,0,4.871,2.182,4.871,4.872C20.871,18.689,18.689,20.871,16,20.871z"/><title></title></g></g>',
vertexMarkup:'<g class="marker-vertex-group" transform="translate(<%= x %>, <%= y %>)"><circle class="marker-vertex" idx="<%= idx %>" r="10" /><path class="marker-vertex-remove-area" idx="<%= idx %>" d="M16,5.333c-7.732,0-14,4.701-14,10.5c0,1.982,0.741,3.833,2.016,5.414L2,25.667l5.613-1.441c2.339,1.317,5.237,2.107,8.387,2.107c7.732,0,14-4.701,14-10.5C30,10.034,23.732,5.333,16,5.333z" transform="translate(5, -33)"/><path class="marker-vertex-remove" idx="<%= idx %>" transform="scale(.8) translate(9.5, -37)" d="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z"><title></title></path></g>',
arrowheadMarkup:'<g class="marker-arrowhead-group marker-arrowhead-group-<%= end %>"><path class="marker-arrowhead" end="<%= end %>" d="M 26 0 L 0 13 L 26 26 z" /></g>',defaults:{type:"link"},disconnect:function(){return this.set({source:g.point(0,0),target:g.point(0,0)})},label:function(a,b){a=a||0;var c=this.get("labels")||[];if(0===arguments.length||1===arguments.length)return c[a];var d=_.merge({},c[a],b),c=c.slice();c[a]=d;return this.set({labels:c})}});
joint.dia.LinkView=joint.dia.CellView.extend({className:function(){return _.unique(this.model.get("type").split(".").concat("link")).join(" ")},options:{shortLinkLength:100},initialize:function(){joint.dia.CellView.prototype.initialize.apply(this,arguments);"function"!==typeof this.constructor.prototype.watchSource&&(this.constructor.prototype.watchSource=this._createWatcher("source"),this.constructor.prototype.watchTarget=this._createWatcher("target"));this._labelCache={};this._markerCache={};this.startListening()},
startListening:function(){this.listenTo(this.model,"change:markup",this.render);this.listenTo(this.model,"change:smooth change:manhattan change:router change:connector",this.update);this.listenTo(this.model,"change:toolMarkup",function(){this.renderTools().updateToolsPosition()});this.listenTo(this.model,"change:labels change:labelMarkup",function(){this.renderLabels().updateLabelPositions()});this.listenTo(this.model,"change:vertices change:vertexMarkup",function(){this.renderVertexMarkers().update()});
this.listenTo(this.model,"change:source",function(a,b){this.watchSource(a,b).update()});this.listenTo(this.model,"change:target",function(a,b){this.watchTarget(a,b).update()})},render:function(){this.$el.empty();var a=V(this.model.get("markup")||this.model.markup);_.isArray(a)||(a=[a]);this._V={};_.each(a,function(a){var c=a.attr("class");c&&(this._V[$.camelCase(c)]=a)},this);if(!this._V.connection)throw Error("link: no connection path in the markup");this.renderTools();this.renderVertexMarkers();
this.renderArrowheadMarkers();V(this.el).append(a);this.renderLabels();this.watchSource(this.model,this.model.get("source")).watchTarget(this.model,this.model.get("target")).update();return this},renderLabels:function(){if(!this._V.labels)return this;this._labelCache={};var a=$(this._V.labels.node).empty(),b=this.model.get("labels")||[];if(!b.length)return this;var c=_.template(this.model.get("labelMarkup")||this.model.labelMarkup),d=V(c());_.each(b,function(b,c){var p=d.clone().node;this._labelCache[c]=
V(p);var h=$(p).find("text"),r=$(p).find("rect"),n=_.extend({"text-anchor":"middle","font-size":14},joint.util.getByPath(b,"attrs/text","/"));h.attr(_.omit(n,"text"));_.isUndefined(n.text)||V(h[0]).text(n.text+"");a.append(p);p=V(h[0]).bbox(!0,a[0]);V(h[0]).translate(0,-p.height/2);h=_.extend({fill:"white",rx:3,ry:3},joint.util.getByPath(b,"attrs/rect","/"));r.attr(_.extend(h,{x:p.x,y:p.y-p.height/2,width:p.width,height:p.height}))},this);return this},renderTools:function(){if(!this._V.linkTools)return this;
var a=$(this._V.linkTools.node).empty(),b=_.template(this.model.get("toolMarkup")||this.model.toolMarkup),b=V(b());a.append(b.node);this._toolCache=b;return this},renderVertexMarkers:function(){if(!this._V.markerVertices)return this;var a=$(this._V.markerVertices.node).empty(),b=_.template(this.model.get("vertexMarkup")||this.model.vertexMarkup);_.each(this.model.get("vertices"),function(c,d){a.append(V(b(_.extend({idx:d},c))).node)});return this},renderArrowheadMarkers:function(){if(!this._V.markerArrowheads)return this;
var a=$(this._V.markerArrowheads.node);a.empty();var b=_.template(this.model.get("arrowheadMarkup")||this.model.arrowheadMarkup);this._V.sourceArrowhead=V(b({end:"source"}));this._V.targetArrowhead=V(b({end:"target"}));a.append(this._V.sourceArrowhead.node,this._V.targetArrowhead.node);return this},update:function(){_.each(this.model.get("attrs"),function(a,c){_.isObject(a.filter)?(this.findBySelector(c).attr(_.omit(a,"filter")),this.applyFilter(c,a.filter)):this.findBySelector(c).attr(a)},this);
var a=this.route=this.findRoute(this.model.get("vertices")||[]);this._findConnectionPoints(a);a=this.getPathData(a);this._V.connection.attr("d",a);this._V.connectionWrap&&this._V.connectionWrap.attr("d",a);this._translateAndAutoOrientArrows(this._V.markerSource,this._V.markerTarget);this.updateLabelPositions();this.updateToolsPosition();this.updateArrowheadMarkers();delete this.options.perpendicular;return this},_findConnectionPoints:function(a){var b,c,d,e=_.first(a);b=this.getConnectionPoint("source",
this.model.get("source"),e||this.model.get("target")).round();var l=_.last(a);a=this.getConnectionPoint("target",this.model.get("target"),l||b).round();var p=this._markerCache;this._V.markerSource&&(p.sourceBBox=p.sourceBBox||this._V.markerSource.bbox(!0),c=g.point(b).move(e||a,p.sourceBBox.width*this._V.markerSource.scale().sx*-1).round());this._V.markerTarget&&(p.targetBBox=p.targetBBox||this._V.markerTarget.bbox(!0),d=g.point(a).move(l||b,p.targetBBox.width*this._V.markerTarget.scale().sx*-1).round());
p.sourcePoint=c||b;p.targetPoint=d||a;this.sourcePoint=b;this.targetPoint=a},updateLabelPositions:function(){if(!this._V.labels)return this;var a=this.model.get("labels")||[];if(!a.length)return this;var b=this._V.connection.node,c=b.getTotalLength();_.each(a,function(a,e){var l=a.position,l=l>c?c:l,l=0>l?c+l:l,l=1<l?l:c*l,l=b.getPointAtLength(l);this._labelCache[e].attr("transform","translate("+l.x+", "+l.y+")")},this);return this},updateToolsPosition:function(){if(!this._V.linkTools)return this;
var a="",b=40;this.getConnectionLength()<this.options.shortLinkLength&&(a="scale(.5)",b/=2);b=this.getPointAtLength(b);this._toolCache.attr("transform","translate("+b.x+", "+b.y+") "+a);return this},updateArrowheadMarkers:function(){if(!this._V.markerArrowheads||"none"===$.css(this._V.markerArrowheads.node,"display"))return this;var a=this.getConnectionLength()<this.options.shortLinkLength?.5:1;this._V.sourceArrowhead.scale(a);this._V.targetArrowhead.scale(a);this._translateAndAutoOrientArrows(this._V.sourceArrowhead,
this._V.targetArrowhead);return this},_createWatcher:function(a){return function(b,c){c=c||{};var d=b.previous(a)||{},e=this["_"+a+"BBoxUpdate"];this._isModel(d)&&this.stopListening(this.paper.getModelById(d.id),"change",e);this._isModel(c)&&this.listenTo(this.paper.getModelById(c.id),"change",e);_.bind(e,this)({cacheOnly:!0});return this}},_sourceBBoxUpdate:function(a){this.lastEndChange="source";a=a||{};var b=this.model.get("source");if(this._isModel(b)){var c=this._makeSelector(b),b=this.paper.findViewByModel(b.id),
c=this.paper.viewport.querySelector(c);this.sourceBBox=b.getStrokeBBox(c)}else this.sourceBBox=g.rect(b.x,b.y,1,1);a.cacheOnly||this.update()},_targetBBoxUpdate:function(a){this.lastEndChange="target";a=a||{};var b=this.model.get("target");if(this._isModel(b)){var c=this._makeSelector(b),b=this.paper.findViewByModel(b.id),c=this.paper.viewport.querySelector(c);this.targetBBox=b.getStrokeBBox(c)}else this.targetBBox=g.rect(b.x,b.y,1,1);a.cacheOnly||this.update()},_translateAndAutoOrientArrows:function(a,
b){a&&a.translateAndAutoOrient(this.sourcePoint,_.first(this.route)||this.targetPoint,this.paper.viewport);b&&b.translateAndAutoOrient(this.targetPoint,_.last(this.route)||this.sourcePoint,this.paper.viewport)},removeVertex:function(a){var b=_.clone(this.model.get("vertices"));b&&b.length&&(b.splice(a,1),this.model.set("vertices",b));return this},addVertex:function(a){this.model.set("attrs",this.model.get("attrs")||{});this.model.get("attrs");for(var b=(this.model.get("vertices")||[]).slice(),c=b.slice(),
d=this._V.connection.node.cloneNode(!1),e=d.getTotalLength(),l,p=b.length+1;p--;)if(b.splice(p,0,a),V(d).attr("d",this.getPathData(this.findRoute(b))),l=d.getTotalLength(),20<l-e)b=c.slice();else break;this.model.set("vertices",b);return Math.max(p,0)},findRoute:function(a){var b=this.model.get("router");if(!b)if(this.model.get("manhattan"))b={name:"orthogonal"};else return a;var c=joint.routers[b.name];if(!_.isFunction(c))throw"unknown router: "+b.name;return c.call(this,a||[],b.args||{},this)},
getPathData:function(a){var b=this.model.get("connector");b||(b=this.model.get("smooth")?{name:"smooth"}:{name:"normal"});if(!_.isFunction(joint.connectors[b.name]))throw"unknown connector: "+b.name;return joint.connectors[b.name].call(this,this._markerCache.sourcePoint,this._markerCache.targetPoint,a||this.model.get("vertices")||{},b.args||{},this)},getConnectionPoint:function(a,b,c){if(this._isPoint(b))a=g.point(b);else if(b="source"===a?this.sourceBBox:this.targetBBox,this._isPoint(c)?a=g.point(c):
(c="source"===a?this.targetBBox:this.sourceBBox,a=(a=g.rect(c).intersectionWithLineFromCenterToPoint(g.rect(b).center()))||g.rect(c).center()),this.paper.options.perpendicularLinks||this.options.perpendicular){c=g.rect(0,a.y,this.paper.options.width,1);var d=g.rect(a.x,0,1,this.paper.options.height);if(c.intersect(g.rect(b)))switch(c=g.rect(b).sideNearestToPoint(a),c){case "left":a=g.point(b.x,a.y);break;case "right":a=g.point(b.x+b.width,a.y);break;default:a=g.rect(b).center()}else if(d.intersect(g.rect(b)))switch(c=
g.rect(b).sideNearestToPoint(a),c){case "top":a=g.point(a.x,b.y);break;case "bottom":a=g.point(a.x,b.y+b.height);break;default:a=g.rect(b).center()}else a=(a=g.rect(b).intersectionWithLineFromCenterToPoint(a))||g.rect(b).center()}else a=(a=g.rect(b).intersectionWithLineFromCenterToPoint(a))||g.rect(b).center();return a},_isModel:function(a){return a&&a.id},_isPoint:function(a){return!this._isModel(a)},_makeSelector:function(a){var b='[model-id="'+a.id+'"]';a.port?b+=' [port="'+a.port+'"]':a.selector&&
(b+=" "+a.selector);return b},getConnectionLength:function(){return this._V.connection.node.getTotalLength()},getPointAtLength:function(a){return this._V.connection.node.getPointAtLength(a)},_beforeArrowheadMove:function(){this.model.trigger("batch:start");this._z=this.model.get("z");this.model.set("z",Number.MAX_VALUE);this.el.style.pointerEvents="none"},_afterArrowheadMove:function(){this._z&&(this.model.set("z",this._z),delete this._z);this.el.style.pointerEvents="visiblePainted";this.model.trigger("batch:stop")},
_createValidateConnectionArgs:function(a){var b=[];b[4]=a;b[5]=this;var c=0,d=0;"source"===a?(c=2,a="target"):(d=2,a="source");a=this.model.get(a);a.id&&(b[c]=this.paper.findViewByModel(a.id),b[c+1]=a.selector&&b[c].el.querySelector(a.selector));return function(a,c){b[d]=a;b[d+1]=a.el===c?void 0:c;return b}},startArrowheadMove:function(a){this._action="arrowhead-move";this._arrowhead=a;this._beforeArrowheadMove();this._validateConnectionArgs=this._createValidateConnectionArgs(this._arrowhead)},pointerdown:function(a,
b,c){joint.dia.CellView.prototype.pointerdown.apply(this,arguments);this._dx=b;this._dy=c;if(!1!==this.options.interactive)switch(a.target.getAttribute("class")){case "marker-vertex":this._action="vertex-move";this._vertexIdx=a.target.getAttribute("idx");break;case "marker-vertex-remove":case "marker-vertex-remove-area":this.removeVertex(a.target.getAttribute("idx"));break;case "marker-arrowhead":this.startArrowheadMove(a.target.getAttribute("end"));break;default:var d=a.target.parentNode.getAttribute("event");
d?"remove"===d?this.model.remove():this.paper.trigger(d,a,this,b,c):(this._vertexIdx=this.addVertex({x:b,y:c}),this._action="vertex-move")}},pointermove:function(a,b,c){joint.dia.CellView.prototype.pointermove.apply(this,arguments);switch(this._action){case "vertex-move":var d=_.clone(this.model.get("vertices"));d[this._vertexIdx]={x:b,y:c};this.model.set("vertices",d);break;case "arrowhead-move":if(this.paper.options.snapLinks){var e=this.paper.options.snapLinks.radius||50,d=this.paper.findViewsInArea({x:b-
e,y:c-e,width:2*e,height:2*e});this._closestView&&this._closestView.unhighlight(this._closestEnd.selector);this._closestView=this._closestEnd=null;var l=g.point(b,c),p,h=Number.MAX_VALUE;_.each(d,function(a){"false"!==a.el.getAttribute("magnet")&&(p=a.model.getBBox().center().distance(l),p<e&&p<h&&this.paper.options.validateConnection.apply(this.paper,this._validateConnectionArgs(a,null))&&(h=p,this._closestView=a,this._closestEnd={id:a.model.id}));a.$("[magnet]").each(_.bind(function(b,c){var d=
V(c).bbox(!1,this.paper.viewport);p=l.distance({x:d.x+d.width/2,y:d.y+d.height/2});p<e&&p<h&&this.paper.options.validateConnection.apply(this.paper,this._validateConnectionArgs(a,c))&&(h=p,this._closestView=a,this._closestEnd={id:a.model.id,selector:a.getSelector(c),port:c.getAttribute("port")})},this))},this);this._closestView&&this._closestView.highlight(this._closestEnd.selector);this.model.set(this._arrowhead,this._closestEnd||{x:b,y:c})}else d="mousemove"===a.type?a.target:document.elementFromPoint(a.clientX,
a.clientY),this._targetEvent!==d&&(this._magnetUnderPointer&&this._viewUnderPointer.unhighlight(this._magnetUnderPointer),(this._viewUnderPointer=this.paper.findView(d))?(this._magnetUnderPointer=this._viewUnderPointer.findMagnet(d))&&this.paper.options.validateConnection.apply(this.paper,this._validateConnectionArgs(this._viewUnderPointer,this._magnetUnderPointer))?this._magnetUnderPointer&&this._viewUnderPointer.highlight(this._magnetUnderPointer):this._magnetUnderPointer=null:this._magnetUnderPointer=
null),this._targetEvent=d,this.model.set(this._arrowhead,{x:b,y:c})}this._dx=b;this._dy=c},pointerup:function(a){joint.dia.CellView.prototype.pointerup.apply(this,arguments);"arrowhead-move"===this._action&&(this.paper.options.snapLinks?(this._closestView&&this._closestView.unhighlight(this._closestEnd.selector),this._closestView=this._closestEnd=null):(this._magnetUnderPointer&&(this._viewUnderPointer.unhighlight(this._magnetUnderPointer),this.model.set(this._arrowhead,{id:this._viewUnderPointer.model.id,
selector:this._viewUnderPointer.getSelector(this._magnetUnderPointer),port:$(this._magnetUnderPointer).attr("port")})),delete this._viewUnderPointer,delete this._magnetUnderPointer,delete this._staticView,delete this._staticMagnet),this._afterArrowheadMove());delete this._action}});"object"===typeof exports&&(module.exports.Link=joint.dia.Link,module.exports.LinkView=joint.dia.LinkView);
joint.dia.Paper=Backbone.View.extend({options:{width:800,height:600,gridSize:50,perpendicularLinks:!1,elementView:joint.dia.ElementView,linkView:joint.dia.LinkView,snapLinks:!1,defaultLink:new joint.dia.Link,validateMagnet:function(a,b){return"passive"!==b.getAttribute("magnet")},validateConnection:function(a,b,c,d,e,l){return("target"===e?c:a)instanceof joint.dia.ElementView}},events:{mousedown:"pointerdown",dblclick:"mousedblclick",click:"mouseclick",touchstart:"pointerdown",mousemove:"pointermove",
touchmove:"pointermove"},initialize:function(){_.bindAll(this,"addCell","sortCells","resetCells","pointerup");this.svg=V("svg").node;this.viewport=V("g").node;V(this.svg).append(V("defs").node);V(this.viewport).attr({"class":"viewport"});V(this.svg).append(this.viewport);this.$el.append(this.svg);this.setDimensions();this.listenTo(this.model,"add",this.addCell);this.listenTo(this.model,"reset",this.resetCells);this.listenTo(this.model,"sort",this.sortCells);$(document).on("mouseup touchend",this.pointerup);
this._mousemoved=!1},remove:function(){$(document).off("mouseup touchend",this.pointerup);Backbone.View.prototype.remove.call(this)},setDimensions:function(a,b){a&&(this.options.width=a);b&&(this.options.height=b);V(this.svg).attr("width",this.options.width);V(this.svg).attr("height",this.options.height);this.trigger("resize")},fitToContent:function(a,b,c){a=a||1;b=b||1;c=c||0;var d=V(this.viewport).bbox(!0,this.svg);a*=Math.ceil((d.width+d.x)/a);b*=Math.ceil((d.height+d.y)/b);a+=c;b+=c;a==this.options.width&&
b==this.options.height||this.setDimensions(a||this.options.width,b||this.options.height)},getContentBBox:function(){var a=this.viewport.getBoundingClientRect(),b=this.viewport.getScreenCTM();return g.rect(Math.abs(a.left-b.e),Math.abs(a.top-b.f),a.width,a.height)},createViewForModel:function(a){var b=a.get("type"),c=b.split(".")[0],b=b.split(".")[1];return joint.shapes[c]&&joint.shapes[c][b+"View"]?new joint.shapes[c][b+"View"]({model:a,interactive:this.options.interactive}):a instanceof joint.dia.Element?
new this.options.elementView({model:a,interactive:this.options.interactive}):new this.options.linkView({model:a,interactive:this.options.interactive})},addCell:function(a){a=this.createViewForModel(a);V(this.viewport).append(a.el);a.paper=this;a.render();$(a.el).find("image").on("dragstart",function(){return!1})},resetCells:function(a){$(this.viewport).empty();a=a.models.slice();a.sort(function(a,c){return a instanceof joint.dia.Link?1:-1});_.each(a,this.addCell,this);this.sortCells()},sortCells:function(){var a=
$(this.viewport).children("[model-id]"),b=this.model.get("cells");this.sortElements(a,function(a,d){var e=b.get($(a).attr("model-id")),l=b.get($(d).attr("model-id"));return(e.get("z")||0)>(l.get("z")||0)?1:-1})},sortElements:function(a,b){var c=$(a),d=c.map(function(){var a=this.parentNode,b=a.insertBefore(document.createTextNode(""),this.nextSibling);return function(){if(a===this)throw Error("You can't sort elements if any one is a descendant of another.");a.insertBefore(this,b);a.removeChild(b)}});
return Array.prototype.sort.call(c,b).each(function(a){d[a].call(this)})},scale:function(a,b,c,d){c||(d=c=0);V(this.viewport).attr("transform","");(c||d)&&V(this.viewport).translate(-c*(a-1),-d*(b-1));V(this.viewport).scale(a,b);this.trigger("scale",c,d);return this},rotate:function(a,b,c){_.isUndefined(b)&&(c=this.viewport.getBBox(),b=c.width/2,c=c.height/2);V(this.viewport).rotate(a,b,c)},findView:function(a){a=this.$(a);return 0===a.length||a[0]===this.el?void 0:a.data("view")?a.data("view"):this.findView(a.parent())},
findViewByModel:function(a){a=_.isString(a)?a:a.id;a=this.$('[model-id="'+a+'"]');if(a.length)return a.data("view")},findViewsFromPoint:function(a){a=g.point(a);var b=_.map(this.model.getElements(),this.findViewByModel);return _.filter(b,function(b){return g.rect(V(b.el).bbox(!1,this.viewport)).containsPoint(a)},this)},findViewsInArea:function(a){a=g.rect(a);var b=_.map(this.model.getElements(),this.findViewByModel);return _.filter(b,function(b){return a.intersect(g.rect(V(b.el).bbox(!1,this.viewport)))},
this)},getModelById:function(a){return this.model.getCell(a)},snapToGrid:function(a){a=V(this.viewport).toLocalPoint(a.x,a.y);return{x:g.snapToGrid(a.x,this.options.gridSize),y:g.snapToGrid(a.y,this.options.gridSize)}},getDefaultLink:function(a,b){return _.isFunction(this.options.defaultLink)?this.options.defaultLink.call(this,a,b):this.options.defaultLink.clone()},mousedblclick:function(a){a.preventDefault();a=joint.util.normalizeEvent(a);var b=this.findView(a.target),c=this.snapToGrid({x:a.clientX,
y:a.clientY});b?b.pointerdblclick(a,c.x,c.y):this.trigger("blank:pointerdblclick",a,c.x,c.y)},mouseclick:function(a){if(!this._mousemoved){a.preventDefault();a=joint.util.normalizeEvent(a);var b=this.findView(a.target),c=this.snapToGrid({x:a.clientX,y:a.clientY});b?b.pointerclick(a,c.x,c.y):this.trigger("blank:pointerclick",a,c.x,c.y)}this._mousemoved=!1},pointerdown:function(a){a.preventDefault();a=joint.util.normalizeEvent(a);var b=this.findView(a.target),c=this.snapToGrid({x:a.clientX,y:a.clientY});
b?(this.sourceView=b,b.pointerdown(a,c.x,c.y)):this.trigger("blank:pointerdown",a,c.x,c.y)},pointermove:function(a){a.preventDefault();a=joint.util.normalizeEvent(a);if(this.sourceView){this._mousemoved=!0;var b=this.snapToGrid({x:a.clientX,y:a.clientY});this.sourceView.pointermove(a,b.x,b.y)}},pointerup:function(a){a=joint.util.normalizeEvent(a);var b=this.snapToGrid({x:a.clientX,y:a.clientY});this.sourceView?(this.sourceView.pointerup(a,b.x,b.y),this.sourceView=null):this.trigger("blank:pointerup",
a,b.x,b.y)}});"object"===typeof exports&&(joint={util:require("../src/core").util,shapes:{},dia:{Element:require("../src/joint.dia.element").Element,ElementView:require("../src/joint.dia.element").ElementView}},_=require("lodash"));joint.shapes.basic={};joint.shapes.basic.Generic=joint.dia.Element.extend({defaults:joint.util.deepSupplement({type:"basic.Generic",attrs:{".":{fill:"#FFFFFF",stroke:"none"}}},joint.dia.Element.prototype.defaults)});
joint.shapes.basic.Rect=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><rect/></g><text/></g>',defaults:joint.util.deepSupplement({type:"basic.Rect",attrs:{rect:{fill:"#FFFFFF",stroke:"black",width:100,height:60},text:{"font-size":14,text:"","ref-x":.5,"ref-y":.5,ref:"rect","y-alignment":"middle","x-alignment":"middle",fill:"black","font-family":"Arial, helvetica, sans-serif"}}},joint.shapes.basic.Generic.prototype.defaults)});
joint.shapes.basic.Text=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><text/></g></g>',defaults:joint.util.deepSupplement({type:"basic.Text",attrs:{text:{"font-size":18,fill:"black"}}},joint.shapes.basic.Generic.prototype.defaults)});
joint.shapes.basic.Circle=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><circle/></g><text/></g>',defaults:joint.util.deepSupplement({type:"basic.Circle",size:{width:60,height:60},attrs:{circle:{fill:"#FFFFFF",stroke:"black",r:30,transform:"translate(30, 30)"},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-y":.5,ref:"circle","y-alignment":"middle",fill:"black","font-family":"Arial, helvetica, sans-serif"}}},joint.shapes.basic.Generic.prototype.defaults)});
joint.shapes.basic.Image=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><image/></g><text/></g>',defaults:joint.util.deepSupplement({type:"basic.Image",attrs:{text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-dy":20,ref:"image","y-alignment":"middle",fill:"black","font-family":"Arial, helvetica, sans-serif"}}},joint.shapes.basic.Generic.prototype.defaults)});
joint.shapes.basic.Path=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><path/></g><text/></g>',defaults:joint.util.deepSupplement({type:"basic.Path",size:{width:60,height:60},attrs:{path:{fill:"#FFFFFF",stroke:"black"},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-dy":20,ref:"path","y-alignment":"middle",fill:"black","font-family":"Arial, helvetica, sans-serif"}}},joint.shapes.basic.Generic.prototype.defaults)});
joint.shapes.basic.PortsModelInterface={initialize:function(){this.updatePortsAttrs();this.on("change:inPorts change:outPorts",this.updatePortsAttrs,this);this.constructor.__super__.constructor.__super__.initialize.apply(this,arguments)},updatePortsAttrs:function(a){var b=this.get("attrs");_.each(this._portSelectors,function(a){b[a]&&delete b[a]});this._portSelectors=[];var c={};_.each(this.get("inPorts"),function(a,b,l){a=this.getPortAttrs(a,b,l.length,".inPorts","in");this._portSelectors=this._portSelectors.concat(_.keys(a));
_.extend(c,a)},this);_.each(this.get("outPorts"),function(a,b,l){a=this.getPortAttrs(a,b,l.length,".outPorts","out");this._portSelectors=this._portSelectors.concat(_.keys(a));_.extend(c,a)},this);this.attr(c,{silent:!0});this.processPorts();this.trigger("process:ports")},getPortSelector:function(a){var b=".inPorts",c=this.get("inPorts").indexOf(a);if(0>c&&(b=".outPorts",c=this.get("outPorts").indexOf(a),0>c))throw Error("getPortSelector(): Port doesn't exist.");return b+">g:nth-child("+(c+1)+")>circle"}};
joint.shapes.basic.PortsViewInterface={initialize:function(){this.listenTo(this.model,"process:ports",this.update);joint.dia.ElementView.prototype.initialize.apply(this,arguments)},update:function(){this.renderPorts();joint.dia.ElementView.prototype.update.apply(this,arguments)},renderPorts:function(){var a=this.$(".inPorts").empty(),b=this.$(".outPorts").empty(),c=_.template(this.model.portMarkup);_.each(_.filter(this.model.ports,function(a){return"in"===a.type}),function(b,e){a.append(V(c({id:e,
port:b})).node)});_.each(_.filter(this.model.ports,function(a){return"out"===a.type}),function(a,e){b.append(V(c({id:e,port:a})).node)})}};
joint.shapes.basic.TextBlock=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><rect/></g><switch><foreignObject requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" class="fobj"><body xmlns="http://www.w3.org/1999/xhtml"><div/></body></foreignObject><text class="content"/></switch></g>',defaults:joint.util.deepSupplement({type:"basic.TextBlock",attrs:{rect:{fill:"#ffffff",stroke:"#000000",width:80,height:100},text:{fill:"#000000","font-size":14,"font-family":"Arial, helvetica, sans-serif"},
".content":{text:"",ref:"rect","ref-x":.5,"ref-y":.5,"y-alignment":"middle","x-alignment":"middle"}},content:""},joint.shapes.basic.Generic.prototype.defaults),initialize:function(){"undefined"!==typeof SVGForeignObjectElement&&(this.setForeignObjectSize(this,this.get("size")),this.setDivContent(this,this.get("content")),this.listenTo(this,"change:size",this.setForeignObjectSize),this.listenTo(this,"change:content",this.setDivContent));joint.shapes.basic.Generic.prototype.initialize.apply(this,arguments)},
setForeignObjectSize:function(a,b){a.attr({".fobj":_.clone(b),div:{style:_.clone(b)}})},setDivContent:function(a,b){a.attr({div:{html:b}})}});
joint.shapes.basic.TextBlockView=joint.dia.ElementView.extend({initialize:function(){joint.dia.ElementView.prototype.initialize.apply(this,arguments);"undefined"===typeof SVGForeignObjectElement&&(this.noSVGForeignObjectElement=!0,this.listenTo(this.model,"change:content",function(a){this.updateContent(a)}))},update:function(a,b){if(this.noSVGForeignObjectElement){var c=this.model,d=_.omit(b||c.get("attrs"),".content");joint.dia.ElementView.prototype.update.call(this,c,d);b&&!_.has(b,".content")||
this.updateContent(c,b)}else joint.dia.ElementView.prototype.update.call(this,c,b)},updateContent:function(a,b){var c=_.merge({},(b||a.get("attrs"))[".content"]);delete c.text;var d=joint.util.breakText(a.get("content"),a.get("size"),c,{svgDocument:this.paper.svg}),c=joint.util.setByPath({},".content",c,"/");c[".content"].text=d;joint.dia.ElementView.prototype.update.call(this,a,c)}});"object"===typeof exports&&(module.exports=joint.shapes.basic);
joint.routers.orthogonal=function(){function a(a,b,c){a=a.x<b.x?a.y>b.y?["up","right"]:a.y<b.y?["down","right"]:["right"]:a.x>b.x?a.y>b.y?["up","left"]:a.y<b.y?["down","left"]:["left"]:a.y>b.y?["up"]:["down"];if(_.contains(a,c))return c;b=_.first(a);switch(c){case "down":if("up"===b)return _.last(a);break;case "up":if("down"===b)return _.last(a);break;case "left":if("right"===b)return _.last(a);break;case "right":if("left"===b)return _.last(a)}return b}var b,c;return function(d){b=this.sourceBBox;
c=this.targetBBox;d=(d||[]).slice();var e=[],l=b.center(),p=c.center();!d.length&&(Math.abs(l.x-p.x)<b.width/2||Math.abs(l.y-p.y)<b.height/2)&&(d=[{x:Math.min(l.x,p.x)+Math.abs(l.x-p.x)/2,y:Math.min(l.y,p.y)+Math.abs(l.y-p.y)/2}]);d.unshift(l);d.push(p);for(var h,r,n=0;n<d.length-1;n++){l=d[n];p=d[n+1];r=_.last(e);0<n&&(h=l,h.d=r?r.y<l.y&&r.x===l.x?"down":r.y>l.y&&r.x===l.x?"up":r.x<l.x&&r.y===l.y?"right":"left":"top",e.push(h),r=h);h=l;var u=p;r=a(h,u,r&&r.d);h="down"===r||"up"===r?{x:h.x,y:u.y,
d:r}:{x:u.x,y:h.y,d:r};g.point(h).equals(g.point(l))||g.point(h).equals(g.point(p))||e.push(h)}return e}}();
joint.routers.manhattan=function(){function a(a,b){for(var c=[],d={x:0,y:0},e=b,u;u=a[e];){var q=u.difference(e);q.equals(d)||(c.unshift(e),d=q);e=u}c.unshift(e);return c}function b(a,b,c){var d=c.step,e=a.center();return _.chain(c.directionMap).pick(b).map(function(b){var c=b.x*a.width/2,h=b.y*a.height/2,c=g.point(e).offset(c,h).snapToGrid(d);a.containsPoint(c)&&c.offset(b.x*d,b.y*d);return c}).value()}function c(c,d,e,r){var n=r.reversed?r.endDirections:r.startDirections,u=r.reversed?r.startDirections:
r.endDirections,q=c instanceof g.rect?b(c,n,r):[c],u=d instanceof g.rect?b(d,u,r):[d],v=1<q.length?c.center():q[0];c=1<u.length?d.center():u[0];u=_.filter(u,function(a){var b=g.point(a).snapToGrid(r.mapGridSize).toString();return _.every(e[b],function(b){return!b.containsPoint(a)})});if(u.length){var y=r.step;d=r.penalties;for(var x=_.chain(u).invoke("snapToGrid",y).min(function(a){return r.estimateCost(v,a)}).value(),u={},A={},z={},n=r.directions,B=n.length,F=B/2,E=r.previousDirIndexes||{},k={},
S={},q=_.chain(q).invoke("snapToGrid",y).each(function(a){var b=a.toString();A[b]=0;z[b]=r.estimateCost(a,x);var c;(c=E[b])||(c=360/B,a=Math.floor(v.theta(a)/c),c=B-a);E[b]=c;S[b]=!0}).map(function(a){return a.toString()}).sortBy(function(a){return z[a]}).value(),y=r.maximumLoops,Ea=r.maxAllowedDirectionChange;q.length&&y--;){var ca=q[0],la=g.point(ca);if(x.equals(la))return r.previousDirIndexes=_.pick(E,ca),a(u,la);q.splice(0,1);S[I]=null;k[I]=!0;for(var Q=E[ca],ca=A[ca],ea=0;ea<B;ea++){var N=Math.abs(ea-
Q);N>F&&(N=B-N);if(!(N>Ea)){var O=n[ea],pa=g.point(la).offset(O.offsetX,O.offsetY),I=pa.toString();if(!k[I]){var Z=g.point(pa).snapToGrid(r.mapGridSize).toString();_.every(e[Z],function(a){return!a.containsPoint(pa)})&&(Z=_.has(S,I),O=ca+O.cost,!Z||O<A[I])&&(u[I]=la,E[I]=ea,A[I]=O,z[I]=O+r.estimateCost(pa,x)+d[N],Z||(N=_.sortedIndex(q,I,function(a){return z[a]}),q.splice(N,0,I),S[I]=!0))}}}}}return r.fallbackRoute(v,c,r)}function d(a,b){b.directions=_.result(b,"directions");b.penalties=_.result(b,
"penalties");b.paddingBox=_.result(b,"paddingBox");this.options.perpendicular=!!b.perpendicular;var d=b.reversed="source"===this.lastEndChange,e=d?g.rect(this.targetBBox):g.rect(this.sourceBBox),n=d?g.rect(this.sourceBBox):g.rect(this.targetBBox);e.moveAndExpand(b.paddingBox);n.moveAndExpand(b.paddingBox);for(var u=this.model,q=this.paper.model,u=_.chain(b.excludeEnds).map(u.get,u).pluck("id").map(q.getCell,q).value(),v=b.mapGridSize,q=_.chain(q.getElements()).difference(u).reject(function(a){return _.contains(b.excludeTypes,
a.get("type"))}).invoke("getBBox").invoke("moveAndExpand",b.paddingBox).foldl(function(a,b){for(var c=b.origin().snapToGrid(v),d=b.corner().snapToGrid(v),e=c.x;e<=d.x;e+=v)for(var h=c.y;h<=d.y;h+=v){var l=e+"@"+h;a[l]=a[l]||[];a[l].push(b)}return a},{}).value(),u=[],y=_.map(a,g.point),x=e.center(),A=0,z=y.length;A<=z;A++){var B=null,F=E||e,E=y[A];E||(E=n,this.model.get("source").id&&this.model.get("target").id||!_.isFunction(b.draggingRoute)||(B=F instanceof g.rect?F.center():F,B=b.draggingRoute(B,
E.origin(),b)));B=B||c(F,E,q,b);(F=_.first(B))&&F.equals(x)&&B.shift();x=_.last(B)||x;u=u.concat(B)}return d?u.reverse():u}var e={step:10,perpendicular:!0,mapGridSize:100,excludeEnds:[],excludeTypes:["basic.Text"],maximumLoops:500,startDirections:["left","right","top","bottom"],endDirections:["left","right","top","bottom"],directionMap:{right:{x:1,y:0},bottom:{x:0,y:1},left:{x:-1,y:0},top:{x:0,y:-1}},maxAllowedDirectionChange:1,paddingBox:function(){var a=this.step;return{x:-a,y:-a,width:2*a,height:2*
a}},directions:function(){var a=this.step;return[{offsetX:a,offsetY:0,cost:a},{offsetX:0,offsetY:a,cost:a},{offsetX:-a,offsetY:0,cost:a},{offsetX:0,offsetY:-a,cost:a}]},penalties:function(){return[0,this.step/2,this.step]},estimateCost:function(a,b){return a.manhattanDistance(b)},fallbackRoute:function(a,b,c){return[((c.prevDirIndexes||{})[a]||0)%2?g.point(a.x,b.y):g.point(b.x,a.y),b]},draggingRoute:null};return function(a,b,c){return d.call(c,a,_.extend({},e,b))}}();
joint.routers.metro=function(){if(!_.isFunction(joint.routers.manhattan))throw"Metro requires the manhattan router.";var a={diagonalCost:null,directions:function(){var a=this.step,c=this.diagonalCost||Math.ceil(Math.sqrt(a*a<<1));return[{offsetX:a,offsetY:0,cost:a},{offsetX:a,offsetY:a,cost:c},{offsetX:0,offsetY:a,cost:a},{offsetX:-a,offsetY:a,cost:c},{offsetX:-a,offsetY:0,cost:a},{offsetX:-a,offsetY:-a,cost:c},{offsetX:0,offsetY:-a,cost:a},{offsetX:a,offsetY:-a,cost:c}]},fallbackRoute:function(a,
c,d){d=a.theta(c);var e={x:c.x,y:a.y},l={x:a.x,y:c.y};if(90<d%180)var p=e,e=l,l=p;e=45>d%90?e:l;a=g.line(a,e);d=90*Math.ceil(d/90);d=g.point.fromPolar(a.squaredLength(),g.toRad(d+135),e);d=g.line(c,d);return(a=a.intersection(d))?[a.round(),c]:[c]}};return function(b,c,d){return joint.routers.manhattan(b,_.extend({},a,c),d)}}();joint.connectors.normal=function(a,b,c){var d=["M",a.x,a.y];_.each(c,function(a){d.push(a.x,a.y)});d.push(b.x,b.y);return d.join(" ")};
joint.connectors.rounded=function(a,b,c,d){var e=d.radius||10,l,p,h,r,n,u,q=["M",a.x,a.y];_.each(c,function(d,y){n=c[y-1]||a;u=c[y+1]||b;h=r||g.point(d).distance(n)/2;r=g.point(d).distance(u)/2;l=g.point(d).move(n,-Math.min(e,h)).round();p=g.point(d).move(u,-Math.min(e,r)).round();q.push(l.x,l.y,"S",d.x,d.y,p.x,p.y,"L")});q.push(b.x,b.y);return q.join(" ")};
joint.connectors.smooth=function(a,b,c){c.length?a=g.bezier.curveThroughPoints([a].concat(c).concat([b])):(c=a.x<b.x?b.x-(b.x-a.x)/2:a.x-(a.x-b.x)/2,a=["M",a.x,a.y,"C",c,a.y,c,b.y,b.x,b.y]);return a.join(" ")};